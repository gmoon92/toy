# MySQL Index

**ì„¸ë¯¸ë‚˜ëª…**: ë°±ì—”ë“œ ê°œë°œìë¥¼ ìœ„í•œ MySQL ì¸ë±ìŠ¤ ê¸°ì´ˆ + ì¡°íšŒ ì„±ëŠ¥ íŠœë‹
**ì„¸ë¯¸ë‚˜ ë‚´ìš©**: RDBMS ì¡°íšŒ ì„±ëŠ¥ì„ ê²°ì •í•˜ëŠ” ì¸ë±ìŠ¤ êµ¬ì¡°ì™€ ë™ì‘ ì›ë¦¬

- Single / Composite Index ì„¤ê³„ ì‹œ ê³ ë ¤ì‚¬í•­
- Range Scan, Index Scan ë“± ì‹¤í–‰ ë°©ì‹ ì´í•´
- EXPLAIN ê¸°ë°˜ ì¿¼ë¦¬ ì„±ëŠ¥ ë¶„ì„
- ì¸ë±ìŠ¤ ìµœì í™”ë¥¼ í†µí•œ ì‹¤ì „ ì„±ëŠ¥ ê°œì„  ì‚¬ë¡€

**ì°¸ì„ ëŒ€ìƒ**: RDBMS ì¸ë±ìŠ¤ ê¸°ë°˜ì˜ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”ì— ê´€ì‹¬ ìˆëŠ” ë¶„
**ì§„í–‰ ì‹œê°„**: ì•½ 30ë¶„

---

## ëª©ì°¨

### 1. ì™œ ì¸ë±ìŠ¤ë¥¼ ì•Œì•„ì•¼ í•˜ëŠ”ê°€ (3ë¶„)
- ë°±ì—”ë“œ ê°œë°œìì™€ ì¸ë±ìŠ¤
- ì‹¤ì œ ì„±ëŠ¥ ì´ìŠˆ ì‚¬ë¡€

### 2. ì¸ë±ìŠ¤ ê¸°ì´ˆ (8ë¶„)
- Full Scan vs Index Scan
- EXPLAINìœ¼ë¡œ ì¿¼ë¦¬ ë¶„ì„í•˜ê¸°
- ì¸ë±ìŠ¤ êµ¬ì¡°: B+Tree
- í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ vs ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤

### 3. ì¸ë±ìŠ¤ ì„¤ê³„ (10ë¶„)
- ë‹¨ì¼ ì¸ë±ìŠ¤
- ë³µí•© ì¸ë±ìŠ¤ ì„¤ê³„ ì›ì¹™
- ì„ íƒë„(Selectivity)
- ì»¤ë²„ë§ ì¸ë±ìŠ¤

### 4. ì˜µí‹°ë§ˆì´ì € ì´í•´ (5ë¶„)
- ë¹„ìš© ê¸°ë°˜ ì˜µí‹°ë§ˆì´ì € (CBO)
- EXPLAIN ì‹¤í–‰ ê³„íš ì½ê¸°
- í†µê³„ ì •ë³´ ê´€ë¦¬

### 5. ì‹¤ì „ íŠœë‹ ì‚¬ë¡€ (3ë¶„)
- 48ì´ˆ â†’ 124ms ê°œì„  ì‚¬ë¡€
- í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 6. Q&A (1ë¶„)

---

# MySQL Index

ì•ˆë…•í•˜ì„¸ìš”. MySQL Index ì„¸ë¯¸ë‚˜ ë°œí‘œë¥¼ ë§¡ê²Œ ëœ ì›¹ê°œë°œ 1íŒ€ ë¬¸ê²¸ì…ë‹ˆë‹¤.

ë°±ì—”ë“œ íŒ€ì—ì„œ ì¸ë±ìŠ¤ë¥¼ ì„¤ëª…í•œë‹¤ê³ ? í•˜ì‹œëŠ” ë¶„ë“¤ì„ ìœ„í•´ ë“¤ì–´ê°€ê¸°ì „ ì²´í¬ í¬ì¸íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ í•œë²ˆ ë´ì£¼ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

## 1. ì™œ ì¸ë±ìŠ¤ë¥¼ ì•Œì•„ì•¼ í•˜ëŠ”ê°€ (3ë¶„)

### 1-1. ì´ëŸ° ë¶„ë“¤ì„ ìœ„í•œ ì„¸ë¯¸ë‚˜ì…ë‹ˆë‹¤

**ì²´í¬ í¬ì¸íŠ¸**

ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¼ë„ í•´ë‹¹ë˜ì‹œë‚˜ìš”?

- âœ… ìš°ë¦¬ íŒ€ì€ JPA/ORM ê¸°ìˆ  ìŠ¤íƒì„ ì‚¬ìš©í•œë‹¤
- âœ… "ì²˜ìŒì—” ê´œì°®ì•˜ëŠ”ë° ì„œë¹„ìŠ¤ê°€ ëŠë ¤ì¡Œì–´ìš”" ë¼ëŠ” ê³ ê° ë¬¸ì˜ë¥¼ ë°›ì•„ë³¸ ì ì´ ìˆë‹¤
- âœ… "ì¸ë±ìŠ¤? ê·¸ê±° DBAê°€ í•˜ëŠ” ê±° ì•„ë‹ˆì•¼?" ë¼ê³  ìƒê°í•œ ì ì´ ìˆë‹¤
- âœ… ì¿¼ë¦¬ íŠœë‹ë³´ë‹¤ ìºì‹±ì´ë‚˜ NoSQLì´ ë¨¼ì € ë– ì˜¤ë¥¸ë‹¤
- âœ… EXPLAINì„ ë³¸ ì ì€ ìˆëŠ”ë°... ì •í™•íˆ ë­˜ ë´ì•¼ í• ì§€ ëª¨ë¥´ê² ë‹¤

**ë°œí‘œ ë©˜íŠ¸**

"í˜¹ì‹œ ì´ ì¤‘ì— í•˜ë‚˜ë¼ë„ í•´ë‹¹ë˜ì‹œëŠ” ë¶„ ê³„ì‹ ê°€ìš”? (ì†ë“¤ì–´ë³´ì„¸ìš”)
ë„¤, ì‚¬ì‹¤ ì €ë„ ë‹¤ í•´ë‹¹ëìŠµë‹ˆë‹¤. (ì›ƒìŒ)

íŠ¹íˆ 'ì¸ë±ìŠ¤ëŠ” DBA ì˜ì—­ ì•„ë‹ˆì•¼?'ë¼ê³  ìƒê°í–ˆì—ˆëŠ”ë°,
ì‹¤ì œë¡œ íŒŒíŠ¸ë„ˆ ì–´ë“œë¯¼ ì‚¬ì´íŠ¸ ì„±ëŠ¥ ê°œí¸ì„ í•˜ë©° ìƒê°ì´ ì™„ì „íˆ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤.

ì˜¤ëŠ˜ì€ ì œê°€ ê·¸ë•Œ ê²ªì—ˆë˜ ê²½í—˜ê³¼ í•¨ê»˜, ë°±ì—”ë“œ ê°œë°œìê°€ ê¼­
ì•Œì•„ì•¼ í•  ì¸ë±ìŠ¤ í•µì‹¬ë§Œ ì •ë¦¬í•´ì„œ ë§ì”€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ë§Œì•½ ì˜¤ëŠ˜ ì„¸ë¯¸ë‚˜ ë‚´ìš©ì´ í•˜ë‚˜ë„ í•´ë‹¹ ì•ˆ ë˜ì‹œëŠ” ë¶„ì€...
ì´ë¯¸ ì¸ë±ìŠ¤ ê³ ìˆ˜ì‹œë‹ˆê¹Œ ë‚˜ì¤‘ì— ì»¤í”¼ í•œì” ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
(ì›ƒìŒ)"

### 1-2. ì™œ ë°±ì—”ë“œê°€ ì¸ë±ìŠ¤ë¥¼ ì•Œì•„ì•¼ í•˜ëŠ”ê°€

**í•µì‹¬ ë©”ì‹œì§€**
- ORM/JPA ê¸°ë°˜ ê°œë°œì—ì„œë„ ê²°êµ­ SQLì€ ê°œë°œìê°€ ë§Œë“ ë‹¤
- **ì¸ë±ìŠ¤ ì„¤ê³„ì— í•„ìš”í•œ ì •ë³´ë¥¼ ê°€ì¥ ì˜ ì•„ëŠ” ì‚¬ëŒ = ë°±ì—”ë“œ ê°œë°œì**
  1. ì‹¤ì œ ë°ì´í„° ì–‘ê³¼ ì¦ê°€ ì¶”ì„¸
  2. í…Œì´ë¸” êµ¬ì¡°ì™€ ê´€ê³„
  3. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ê²€ìƒ‰ ì¡°ê±´
  4. ìì£¼ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ íŒ¨í„´
- ì¸ë±ìŠ¤ ì„¤ê³„ë§Œ ì œëŒ€ë¡œ í•´ë„ 10~100ë°° ì„±ëŠ¥ ê°œì„  ê°€ëŠ¥

**ë°œí‘œ ë©˜íŠ¸**

"ì˜¤ëŠ˜ ì´ ì£¼ì œë¥¼ ì„ íƒí•œ ì´ìœ ëŠ”, ìì‚¬ ëª¨ë“  ì œí’ˆ ë°±ì—”ë“œ ê¸°ìˆ  ìŠ¤íƒì—ì„œ JPAê°€ ê¸°ë³¸ ìŠ¤í™ìœ¼ë¡œ ìë¦¬ ì¡ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

JPAëŠ” ì¿¼ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ê¸° ë•Œë¬¸ì— ê°œë°œ ì†ë„ë¥¼ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ëŸ¬ë‹ì»¤ë¸Œê°€ ë†’ì•„ì„œ ì˜ëª» ì‚¬ìš©í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ì— ì¹˜ëª…ì ì¸ ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì§ˆë¬¸ì´ ìˆìŠµë‹ˆë‹¤. 'ì¸ë±ìŠ¤ëŠ” DBAê°€ ì„¤ê³„í•˜ëŠ” ê±° ì•„ë‹ˆì•¼?'

ë¬¼ë¡  DBAì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì œë¡œ ì¸ë±ìŠ¤ë¥¼ ì œëŒ€ë¡œ ì„¤ê³„í•˜ë ¤ë©´ ë‹¤ìŒì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤:

ì²«ì§¸, ì‹¤ì œ ë°ì´í„°ê°€ ì–¼ë§ˆë‚˜ ìˆê³  ì–¼ë§ˆë‚˜ ë¹ ë¥´ê²Œ ì¦ê°€í•˜ëŠ”ê°€?
ë‘˜ì§¸, í…Œì´ë¸” ê°„ì˜ ê´€ê³„ì™€ êµ¬ì¡°ëŠ” ì–´ë–»ê²Œ ë˜ì–´ ìˆëŠ”ê°€?
ì…‹ì§¸, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ì–´ë–¤ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ”ê°€?
ë„·ì§¸, ì–´ë–¤ ì¿¼ë¦¬ê°€ ìì£¼ ì‹¤í–‰ë˜ëŠ”ê°€?

ì´ ëª¨ë“  ê²ƒì„ ê°€ì¥ ì˜ ì•„ëŠ” ì‚¬ëŒì´ ëˆ„êµ¬ì¼ê¹Œìš”? ë°”ë¡œ ë°±ì—”ë“œ ê°œë°œìì…ë‹ˆë‹¤.

DBAëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì „ë¬¸ê°€ì´ì§€ë§Œ, ìš°ë¦¬ ì„œë¹„ìŠ¤ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë°ì´í„° íŠ¹ì„±ì„ ë°±ì—”ë“œë§Œí¼ ê¹Šì´ ì´í•´í•˜ê¸°ëŠ” ì–´ë µìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë°±ì—”ë“œ ê°œë°œìê°€ ì¸ë±ìŠ¤ ì„¤ê³„ì— ì£¼ë„ì ìœ¼ë¡œ ì°¸ì—¬í•´ì•¼ í•˜ê³ , ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ” ì¸ë±ìŠ¤ë¥¼ ì œëŒ€ë¡œ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.

ì˜¤ëŠ˜ ì„¸ë¯¸ë‚˜ì—ì„œëŠ” ì‹¤ì œ ì‚¬ë¡€ë¥¼ í†µí•´ ì¸ë±ìŠ¤ê°€ ì™œ ì¤‘ìš”í•œì§€, ê·¸ë¦¬ê³  ì–´ë–»ê²Œ ì„¤ê³„í•˜ê³  íŠœë‹í•´ì•¼ í•˜ëŠ”ì§€ í•¨ê»˜ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤."

### 1-3. ì‹¤ì œ ì‚¬ë¡€: íŒŒíŠ¸ë„ˆ ì–´ë“œë¯¼ ì‚¬ì´íŠ¸ì˜ 504 íƒ€ì„ì•„ì›ƒ ì´ìŠˆ

**ë¬¸ì œ ìƒí™©**
- ê´€ë¦¬ì ê²°ì œ ë‚´ì—­ í˜ì´ì§€ ë¡œë”© ë¶ˆê°€ (504 Timeout)
- ì›ì¸: ëŠë¦° ì¡°íšŒ ì¿¼ë¦¬
- SQL ì‹¤í–‰ ì‹œ ê³¼ë„í•œ ë””ìŠ¤í¬ I/O ë°œìƒ

**í•µì‹¬ ì¸ì‚¬ì´íŠ¸**
- I/O = ì¿¼ë¦¬ ì†ë„ì˜ ì ˆëŒ€ì  ìš”ì†Œ
- íŠœë‹ì˜ ì²« ë‹¨ê³„ëŠ” **"ì¿¼ë¦¬ I/O ì¤„ì´ê¸°" = ì¸ë±ìŠ¤ ì„¤ê³„**

**ë°œí‘œ ë©˜íŠ¸**

"ì‹¤ì œë¡œ ê²ªì—ˆë˜ ì‚¬ë¡€ë¥¼ í•˜ë‚˜ ë§ì”€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

íŒŒíŠ¸ë„ˆ ê´€ë¦¬ì ëŒ€í‘œì •ë³´ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ 504 íƒ€ì„ì•„ì›ƒì´ ë°œìƒí•˜ì—¬ í˜ì´ì§€ê°€ ì•„ì˜ˆ ë¡œë“œë˜ì§€ ì•ŠëŠ” í˜„ìƒì´ ìˆì—ˆìŠµë‹ˆë‹¤.
ë¶„ì„ ê²°ê³¼, íŠ¹ì • ì¡°íšŒ ì¿¼ë¦¬ê°€ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë ¤ì„œ ë°œìƒí•œ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.

ëŒ€ë¶€ë¶„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ ì´ìŠˆëŠ” ì´ì²˜ëŸ¼ ëŠë¦° ì¡°íšŒ ì¿¼ë¦¬ì—ì„œ ë¹„ë¡¯ë©ë‹ˆë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ì„ ê°œì„ í•˜ëŠ” í•µì‹¬ì€ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ê°€ ë””ìŠ¤í¬ I/Oë¥¼ ì–¼ë§ˆë‚˜ ì¤„ì¼ ìˆ˜ ìˆëŠëƒì…ë‹ˆë‹¤.

'ì¸ë±ìŠ¤ëŠ” DBA ì˜ì—­ ì•„ë‹Œê°€?'ë¼ê³  ìƒê°í•˜ì‹¤ ìˆ˜ ìˆì§€ë§Œ,
JPA ê¸°ë°˜ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì¡°íšŒ ì¿¼ë¦¬ ë¡œì§ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì„ ê°€ì¥ ì˜ ì•„ëŠ” ì‚¬ëŒì´ ë°”ë¡œ ë°±ì—”ë“œ ê°œë°œìì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë°±ì—”ë“œ ê°œë°œìê°€ ì¸ë±ìŠ¤ ì„¤ê³„ì— ì ê·¹ ì°¸ì—¬í•´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œìš”? ì‹¤ì œ ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ ë³´ë©´ì„œ ì§„ë‹¨í•´ë³´ê² ìŠµë‹ˆë‹¤."

## 2. ì¸ë±ìŠ¤ ê¸°ì´ˆ (8ë¶„)

### 2-1. Full Scan vs Index Scan - ì‹¤ì œ ëŠë¦° ì¿¼ë¦¬ ì˜ˆì‹œ

**ì‹œë‚˜ë¦¬ì˜¤**: íŒŒíŠ¸ë„ˆ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ íŠ¹ì • íšŒì‚¬ì˜ ë¯¸ê²°ì œ ë‚´ì—­ ì¡°íšŒ

```sql
-- íŒŒíŠ¸ë„ˆ ë¯¸ê²°ì œ ë‚´ì—­ ì¡°íšŒ ì¿¼ë¦¬
SELECT *
FROM tb_payment
WHERE company_name LIKE 'apple%'
  AND status = 'UNPAID';
```

### 2-2. EXPLAINìœ¼ë¡œ ì¿¼ë¦¬ ë¶„ì„í•˜ê¸°

```sql
EXPLAIN SELECT * FROM tb_payment
WHERE company_name LIKE 'apple%'
  AND status = 'UNPAID';
```

**ê²°ê³¼**
```
+----+-------------+------------+------+---------------+------+---------+------+---------+-------------+
| id | select_type | table      | type | possible_keys | key  | key_len | ref  | rows    | Extra       |
+----+-------------+------------+------+---------------+------+---------+------+---------+-------------+
|  1 | SIMPLE      | tb_payment | ALL  | NULL          | NULL | NULL    | NULL | 1000000 | Using where |
+----+-------------+------------+------+---------------+------+---------+------+---------+-------------+
```

**ë¬¸ì œì  ë°œê²¬**
- `type: ALL` â†’ í…Œì´ë¸” ì „ì²´ ìŠ¤ìº” (Full Scan)
- `key: NULL` â†’ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- `rows: 1000000` â†’ 100ë§Œ ê±´ ì „ì²´ë¥¼ ì½ì–´ì•¼ í•¨

### 2-3. ì¸ë±ìŠ¤ êµ¬ì¡°: B+Tree ì´í•´

**Full Scan ë™ì‘ ê³¼ì •**
```
1. MySQL ì—”ì§„ì´ ì¿¼ë¦¬ ì‹¤í–‰
   â†“
2. tb_payment í…Œì´ë¸”ì˜ ëª¨ë“  Data Pageë¥¼ ì½ê¸° ì‹œì‘
   â†“
3. 100ë§Œ ê±´ì˜ ê²°ì œ ë°ì´í„°ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í™•ì¸
   - ê° Rowì˜ company_name ì»¬ëŸ¼ì„ ê²€ì‚¬
   - 'apple'ë¡œ ì‹œì‘í•˜ëŠ”ì§€ í™•ì¸
   - statusê°€ 'UNPAID'ì¸ì§€ í™•ì¸
   â†“
4. ì¡°ê±´ì— ë§ëŠ” Rowë§Œ ë°˜í™˜
```

**ì™œ ëŠë¦´ê¹Œ?**
- ğŸ’¥ **ê³¼ë„í•œ Disk I/O**: ëª¨ë“  ë°ì´í„°ë¥¼ ì½ì–´ì•¼ í•¨
- ğŸ’¥ **ë°ì´í„°ê°€ ë§ì„ìˆ˜ë¡ ëŠë ¤ì§**: 100ë§Œ ê±´ â†’ 1000ë§Œ ê±´ì´ë©´ 10ë°° ëŠë ¤ì§

**ë°œí‘œ ë©˜íŠ¸**

"EXPLAINìœ¼ë¡œ í™•ì¸í•´ë³´ë‹ˆ typeì´ ALLì´ê³  keyê°€ NULLì…ë‹ˆë‹¤. ì´ëŠ” ì¸ë±ìŠ¤ë¥¼ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•Šê³  í…Œì´ë¸” ì „ì²´ë¥¼ ìŠ¤ìº”í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

íŒŒíŠ¸ë„ˆ ê´€ë¦¬ìê°€ 'apple'ë¡œ ì‹œì‘í•˜ëŠ” íšŒì‚¬ì˜ ë¯¸ê²°ì œ ë‚´ì—­ì„ ì¡°íšŒí•˜ë ¤ê³  í•˜ëŠ”ë°, MySQLì€ 100ë§Œ ê±´ì˜ ê²°ì œ ë°ì´í„°ë¥¼ ì²˜ìŒë¶€í„° ëê¹Œì§€ ì½ìœ¼ë©´ì„œ íšŒì‚¬ëª…ê³¼ ìƒíƒœë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¹ì—°íˆ ëŠë¦´ ìˆ˜ë°–ì— ì—†ì£ .

ê·¸ë ‡ë‹¤ë©´ ì™œ ì´ë ‡ê²Œ ë§ì€ ë°ì´í„°ë¥¼ ì½ì–´ì•¼ í• ê¹Œìš”? ì´ë¥¼ ì´í•´í•˜ë ¤ë©´ MySQLì˜ Disk I/Oì™€ Page ê°œë…ì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤."

### 2-4. Full Scanì´ ëŠë¦° ì´ìœ : Disk I/O

#### MySQL ì•„í‚¤í…ì²˜ (ê°„ëµ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       MySQL Server                  â”‚
â”‚  SQL Parser â†’ Optimizer â†’ Executor  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“â†‘ (ë°ì´í„° ìš”ì²­/ì‘ë‹µ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    InnoDB Storage Engine            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Buffer Pool (ë©”ëª¨ë¦¬ ìºì‹œ)     â”‚  â”‚
â”‚  â”‚  - ìì£¼ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° ìºì‹±   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â†“â†‘ (Disk I/O)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Disk (ë°ì´í„° íŒŒì¼)            â”‚  â”‚
â”‚  â”‚  - ì‹¤ì œ ë°ì´í„° ì €ì¥            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ ë°ì´í„°ë¥¼ ì½ëŠ” ê³¼ì •**
```
ì¿¼ë¦¬ ì‹¤í–‰ â†’ Buffer Pool í™•ì¸
           â”œâ”€ Hit (ë©”ëª¨ë¦¬ì— ìˆìŒ) â†’ ì¦‰ì‹œ ë°˜í™˜ (ë¹ ë¦„, ë‚˜ë…¸ì´ˆ)
           â””â”€ Miss (ë©”ëª¨ë¦¬ì— ì—†ìŒ) â†’ Diskì—ì„œ ì½ê¸° (ëŠë¦¼, ë°€ë¦¬ì´ˆ)
```

#### Page = MySQLì´ ë°ì´í„°ë¥¼ ì½ëŠ” ê¸°ë³¸ ë‹¨ìœ„

**Pageì˜ íŠ¹ì§•**
- ê¸°ë³¸ í¬ê¸°: **16KB**
- MySQLì€ ë°ì´í„°ë¥¼ **Page ë‹¨ìœ„ë¡œ ì½ê³  ì“´ë‹¤**
- Row 1ê°œë¥¼ ì½ì–´ë„ í•´ë‹¹ Page ì „ì²´(16KB)ë¥¼ ì½ìŒ

**Pageì˜ ì¢…ë¥˜**
- **Data Pages**: ì‹¤ì œ í…Œì´ë¸”ì˜ í–‰ ë°ì´í„° ì €ì¥
- **Index Pages**: ì¸ë±ìŠ¤ ë°ì´í„° ì €ì¥
- **Undo/Redo Log Pages**: íŠ¸ëœì­ì…˜ ì •ë³´ ì €ì¥

**Buffer Pool = Page ìºì‹± ì˜ì—­**
- ìì£¼ ì‚¬ìš©ë˜ëŠ” Pageë¥¼ ë©”ëª¨ë¦¬ì— ìºì‹±
- ë¬¼ë¦¬ ë©”ëª¨ë¦¬ì˜ 50-80%ë¥¼ Buffer Poolë¡œ í• ë‹¹
- Buffer Poolì— ìˆìœ¼ë©´ ë¹ ë¥´ê³ , ì—†ìœ¼ë©´ Disk I/O ë°œìƒ

**ë°œí‘œ ë©˜íŠ¸**

"MySQLì€ í¬ê²Œ ë‘ ê³„ì¸µìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. MySQL ServerëŠ” ì¿¼ë¦¬ë¥¼ ë¶„ì„í•˜ê³  ìµœì í™”í•˜ë©°, Storage Engineì€ ì‹¤ì œ ë°ì´í„°ë¥¼ ì½ê³  ì”ë‹ˆë‹¤.

ì—¬ê¸°ì„œ í•µì‹¬ì€ Buffer Poolì…ë‹ˆë‹¤. ìì£¼ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ìºì‹±í•´ì„œ Disk I/Oë¥¼ ìµœì†Œí™”í•˜ëŠ” ê±°ì£ .

ë©”ëª¨ë¦¬ì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜í•  ìˆ˜ ìˆì§€ë§Œ, ì—†ìœ¼ë©´ ë””ìŠ¤í¬ì—ì„œ ì½ì–´ì•¼ í•˜ë¯€ë¡œ ìˆ˜ì²œ ë°° ëŠë ¤ì§‘ë‹ˆë‹¤.

ê·¸ë¦¬ê³  MySQLì€ ë°ì´í„°ë¥¼ ê°œë³„ Row ë‹¨ìœ„ê°€ ì•„ë‹ˆë¼ 16KB í¬ê¸°ì˜ Page ë‹¨ìœ„ë¡œ ì½ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ Full Scanì„ í•˜ë©´ ìˆ˜ë°±~ìˆ˜ì²œ ê°œì˜ Pageë¥¼ ì½ì–´ì•¼ í•˜ë¯€ë¡œ ì—„ì²­ë‚œ Disk I/Oê°€ ë°œìƒí•˜ëŠ” ê²ë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”? ë°”ë¡œ ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤."

### 2-5. ì¸ë±ìŠ¤ë€ ë¬´ì—‡ì¸ê°€?

**ê°„ë‹¨íˆ ë§í•˜ë©´: ì±…ì˜ ìƒ‰ì¸(ëª©ì°¨)**

ì±…ì—ì„œ íŠ¹ì • ë‚´ìš©ì„ ì°¾ì„ ë•Œ
- âŒ ë‚˜ìœ ë°©ë²•: 1í˜ì´ì§€ë¶€í„° ëê¹Œì§€ ì „ë¶€ ì½ê¸°
- âœ… ì¢‹ì€ ë°©ë²•: ë’¤ìª½ ìƒ‰ì¸ì—ì„œ í‚¤ì›Œë“œ ì°¾ê³  â†’ í•´ë‹¹ í˜ì´ì§€ë¡œ ë°”ë¡œ ì´ë™

ë°ì´í„°ë² ì´ìŠ¤ë„ ë§ˆì°¬ê°€ì§€
- âŒ Full Scan: í…Œì´ë¸” ì „ì²´ë¥¼ ì²˜ìŒë¶€í„° ëê¹Œì§€ ì½ê¸°
- âœ… Index Scan: ì¸ë±ìŠ¤ì—ì„œ ìœ„ì¹˜ ì°¾ê³  â†’ í•´ë‹¹ ë°ì´í„°ë¡œ ë°”ë¡œ ì´ë™

### 2-6. ë‹¨ì¼ ì¸ë±ìŠ¤ë¡œ ë¬¸ì œ í•´ê²°

```sql
-- company_name ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_company_name ON tb_payment(company_name);
```

**ë‹¨ì¼ ì¸ë±ìŠ¤ ìƒì„±**

```sql
EXPLAIN SELECT * FROM tb_payment
WHERE company_name LIKE 'apple%'
  AND status = 'UNPAID';
```

**ê°œì„  ê²°ê³¼**
```
+----+-------------+------------+-------+------------------+------------------+---------+------+------+-----------------------+
| id | select_type | table      | type  | possible_keys    | key              | key_len | ref  | rows | Extra                 |
+----+-------------+------------+-------+------------------+------------------+---------+------+------+-----------------------+
|  1 | SIMPLE      | tb_payment | range | idx_company_name | idx_company_name | 767     | NULL |   15 | Using index condition |
+----+-------------+------------+-------+------------------+------------------+---------+------+------+-----------------------+
```

**ê°œì„  í¬ì¸íŠ¸**
- `type: range` â†’ ì¸ë±ìŠ¤ ë²”ìœ„ ìŠ¤ìº” ì‚¬ìš© âœ…
- `key: idx_company_name` â†’ ì¸ë±ìŠ¤ ì‚¬ìš© ì¤‘ âœ…
- `rows: 15` â†’ 100ë§Œ ê±´ â†’ 15ê±´ìœ¼ë¡œ ëŒ€í­ ê°ì†Œ âœ…

**ì„±ëŠ¥ ê°œì„ **
- **ê²€ìƒ‰ ì‹œê°„: 5ì´ˆ â†’ 0.02ì´ˆ (250ë°° ê°œì„ )**
- **ì½ì€ Page ìˆ˜: ìˆ˜ì²œ ê°œ â†’ ìˆ˜ì‹­ ê°œ**

### 2-7. ì¸ë±ìŠ¤ ë™ì‘ ì›ë¦¬: Full Scan vs Index Scan

#### Full Scan vs Index Scan ë¹„êµ

**ì¼€ì´ìŠ¤ 1: ì¸ë±ìŠ¤ê°€ ì—†ì„ ë•Œ (Full Scan)**

```
1. MySQL ì—”ì§„ì´ ì¿¼ë¦¬ ì‹¤í–‰
   â†“
2. Buffer Poolì—ì„œ tb_paymentì˜ ëª¨ë“  Data Page í™•ì¸
   - Buffer Poolì— ì—†ëŠ” PageëŠ” Diskì—ì„œ ë¡œë“œ (Disk I/O ë°œìƒ)
   â†“
3. ëª¨ë“  Pageë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì½ìœ¼ë©° company_name, status ì»¬ëŸ¼ í™•ì¸
   - 100ë§Œ ê±´ì´ë©´ 100ë§Œ ê±´ ëª¨ë‘ í™•ì¸
   - ìˆ˜ë°±~ìˆ˜ì²œ ê°œì˜ Page ì½ê¸° í•„ìš”
   â†“
4. ì¡°ê±´ì— ë§ëŠ” Rowë§Œ ë°˜í™˜
```

**ë¬¸ì œì **
- ğŸ’¥ **ê³¼ë„í•œ Disk I/O**: ëª¨ë“  Data Pageë¥¼ ì½ì–´ì•¼ í•¨
- ğŸ’¥ **Random I/O ë°œìƒ**: Pageê°€ ë””ìŠ¤í¬ ê³³ê³³ì— í©ì–´ì ¸ ìˆìŒ
- ğŸ’¥ **ë°ì´í„° ì¦ê°€ ì‹œ ì„±ëŠ¥ ê¸‰ê²©íˆ ì•…í™”**: 100ë§Œ ê±´ â†’ 1000ë§Œ ê±´ì´ë©´ 10ë°° ëŠë ¤ì§

**ì¼€ì´ìŠ¤ 2: ì¸ë±ìŠ¤ê°€ ìˆì„ ë•Œ (Index Scan)**

```
1. MySQL ì—”ì§„ì´ ì¿¼ë¦¬ ì‹¤í–‰
   â†“
2. company_name ì»¬ëŸ¼ì˜ ì¸ë±ìŠ¤(B+Tree)ë¥¼ íƒìƒ‰
   - Buffer Poolì— ì¸ë±ìŠ¤ Page ë¡œë“œ (í¬ê¸°ê°€ ì‘ì•„ ë¹ ë¦„)
   - 'apple'ë¡œ ì‹œì‘í•˜ëŠ” ë²”ìœ„ë¥¼ ë¹ ë¥´ê²Œ íƒìƒ‰
   â†“
3. ë¦¬í”„ ë…¸ë“œì—ì„œ ì¡°ê±´ì— ë§ëŠ” PK ëª©ë¡ ì¶”ì¶œ
   - ì˜ˆ: [101, 523, 1247, ..., 98234] (15ê±´ë§Œ ì°¾ìŒ)
   â†“
4. PKë¡œ ì‹¤ì œ í…Œì´ë¸” Data Pageì—ì„œ Row ì¡°íšŒ
   - status = 'UNPAID' ì¡°ê±´ ì¶”ê°€ í™•ì¸
   - 15ê°œì˜ Pageë§Œ ì½ìœ¼ë©´ ë¨ (Random I/O ìµœì†Œí™”)
   â†“
5. ì¡°ê±´ì— ë§ëŠ” Row ë°˜í™˜
```

**ì¥ì **
- âœ… **ìµœì†Œ Disk I/O**: í•„ìš”í•œ Pageë§Œ ì„ íƒì ìœ¼ë¡œ ì½ìŒ
- âœ… **Random I/O ìµœì†Œí™”**: ì¸ë±ìŠ¤ë¡œ í•„í„°ë§ í›„ í•„ìš”í•œ ê²ƒë§Œ ì ‘ê·¼
- âœ… **ë°ì´í„° ì¦ê°€í•´ë„ ì„±ëŠ¥ ì•ˆì •ì **: B+TreeëŠ” ë¡œê·¸ ì‹œê°„ ë³µì¡ë„ O(log n)

[ê·¸ë¦¼: Buffer Poolê³¼ Disk I/O ìƒì„¸ íë¦„ë„]
```
[Buffer Pool (Memory)]           [Disk]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Index Pages     â”‚  â†ì½ê¸°â†’      â”‚ Index Files     â”‚
â”‚ (ì‘ê³  ë¹ ë¦„)       â”‚             â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data Pages      â”‚  â†ì½ê¸°â†’      â”‚ Data Files      â”‚
â”‚ (í•„ìš”í•œ ê²ƒë§Œ)      â”‚             â”‚ (Random I/O)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë°œí‘œ ë©˜íŠ¸**

"company_nameì— ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í•˜ë‹ˆ typeì´ rangeë¡œ ë°”ë€Œê³ , keyì— idx_company_nameì´ í‘œì‹œë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  rowsê°€ 100ë§Œì—ì„œ 15ë¡œ ì¤„ì—ˆìŠµë‹ˆë‹¤. ì„±ëŠ¥ì€ 250ë°° ê°œì„ ë˜ì—ˆì£ .

ì™œ ì´ë ‡ê²Œ ë¹ ë¥¼ê¹Œìš”?

ì¸ë±ìŠ¤ê°€ ì—†ìœ¼ë©´ MySQLì€ í…Œì´ë¸” ì „ì²´ë¥¼ ìŠ¤ìº”í•´ì•¼ í•©ë‹ˆë‹¤. 100ë§Œ ê±´ì˜ ê²°ì œ ë°ì´í„°ê°€ ì €ì¥ëœ ìˆ˜ì²œ ê°œì˜ Pageë¥¼ ëª¨ë‘ ì½ì–´ì•¼ í•˜ì£ .

í•˜ì§€ë§Œ ì¸ë±ìŠ¤ê°€ ìˆìœ¼ë©´ ë‹¤ë¦…ë‹ˆë‹¤. ë¨¼ì € ì¸ë±ìŠ¤ë¥¼ íƒìƒ‰í•´ì„œ 'apple'ë¡œ ì‹œì‘í•˜ëŠ” íšŒì‚¬ì˜ ê²°ì œ ë°ì´í„° ìœ„ì¹˜ë¥¼ ë¹ ë¥´ê²Œ ì°¾ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  í•´ë‹¹ ìœ„ì¹˜ì˜ ë°ì´í„°ë§Œ ì½ìœ¼ë©´ ë˜ë¯€ë¡œ ê·¹ì†Œìˆ˜ì˜ Pageë§Œ ì ‘ê·¼í•˜ë©´ ë©ë‹ˆë‹¤. status ì¡°ê±´ì€ í…Œì´ë¸”ì—ì„œ ì¶”ê°€ë¡œ í™•ì¸í•˜ì§€ë§Œ, ì´ë¯¸ 15ê±´ìœ¼ë¡œ ì¤„ì–´ë“  ìƒíƒœë¼ ë¶€ë‹´ì´ ì ìŠµë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì¸ë±ìŠ¤ëŠ” ì–´ë–¤ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆê¸¸ë˜ ì´ë ‡ê²Œ ë¹ ë¥¼ê¹Œìš”?"

### 2-8. B+Tree êµ¬ì¡° ìƒì„¸

**B+Treeì˜ íŠ¹ì§•**

**êµ¬ì¡°**
- ëŒ€ë¶€ë¶„ì˜ RDBMSëŠ” B-Tree ê¸°ë°˜ ì¸ë±ìŠ¤ ì‚¬ìš©
- MySQL InnoDBëŠ” B+Tree ìë£Œêµ¬ì¡° ì‚¬ìš© (B-Treeì˜ í™•ì¥ ë²„ì „)
- ì‹œí€€ì…œ ì ‘ê·¼ê³¼ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ì„ ê³ ë ¤í•œ êµ¬ì¡°

**B+Treeì˜ êµ¬ì„±**
- **ë£¨íŠ¸/ë¸Œëœì¹˜ ë…¸ë“œ**: í‚¤ ê°’ë§Œ ì €ì¥ (íƒìƒ‰ ê²½ë¡œ ì œê³µ)
- **ë¦¬í”„ ë…¸ë“œ**: ì‹¤ì œ ì¸ë±ìŠ¤ ê°’ + PK(í´ëŸ¬ìŠ¤í„°ë§ í‚¤) ì €ì¥
- **ë¦¬í”„ ë…¸ë“œëŠ” Linked Listë¡œ ì—°ê²°** â†’ ë²”ìœ„ ê²€ìƒ‰ì— ìµœì í™”

[ê·¸ë¦¼: B+Tree êµ¬ì¡° ì˜ˆì‹œ]
```
                    [Root Node]
                   /     |     \
          [Branch]   [Branch]   [Branch]
          /    \      /    \      /    \
    [Leaf] [Leaf] [Leaf] [Leaf] [Leaf] [Leaf]
     â†”       â†”       â†”       â†”       â†”       â†”  (Linked List)
   (ê°’,PK) (ê°’,PK) (ê°’,PK) (ê°’,PK) (ê°’,PK) (ê°’,PK)
```

#### ì¸ë±ìŠ¤ì˜ í•µì‹¬ íŠ¹ì„±: ì •ë ¬

**ì¸ë±ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì™¼ìª½ë¶€í„° ì˜¤ë¦„ì°¨ìˆœ(ASC)ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ì €ì¥ëœë‹¤**

```sql
-- ì˜ˆ: created_at ì»¬ëŸ¼ ì¸ë±ìŠ¤
-- ë¦¬í”„ ë…¸ë“œ ì €ì¥ ìˆœì„œ
[2024-01-01] â†’ [2024-01-02] â†’ [2024-01-03] â†’ ... (ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ)
```

**ì™œ ì´ê²Œ ì¤‘ìš”í•œê°€?**

1. **ë²”ìœ„ ê²€ìƒ‰ ìµœì í™”**
   ```sql
   -- âœ… íš¨ìœ¨ì : ì‹œì‘ì ì„ ì°¾ê³  ìˆœì°¨ì ìœ¼ë¡œ ì½ê¸°ë§Œ í•˜ë©´ ë¨
   WHERE created_at >= '2024-01-01' AND created_at <= '2024-01-31'

   -- âŒ ë¹„íš¨ìœ¨ì : ì „ì²´ë¥¼ ë’¤ì ¸ì•¼ í•¨
   WHERE created_at != '2024-01-01'
   ```

2. **ì •ë ¬ ì¿¼ë¦¬ ìµœì í™”**
   ```sql
   -- âœ… ì¸ë±ìŠ¤ ìˆœì„œ ê·¸ëŒ€ë¡œ ì½ê¸° (ì¶”ê°€ ì •ë ¬ ë¶ˆí•„ìš”)
   SELECT * FROM tb_user ORDER BY created_at ASC

   -- âŒ ì—­ìˆœ ì½ê¸°ëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¼
   SELECT * FROM tb_user ORDER BY created_at DESC
   ```

**ì—­ì¸ë±ìŠ¤(Descending Index) - MySQL 8.0 ì´ìƒ**

```sql
-- ë‚´ë¦¼ì°¨ìˆœ ì¸ë±ìŠ¤ ìƒì„± (ì—­ìˆœìœ¼ë¡œ ì €ì¥)
CREATE INDEX idx_created_desc ON tb_user(created_at DESC);

-- ì´ì œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ë„ ìµœì í™”ë¨
SELECT * FROM tb_user ORDER BY created_at DESC;
-- Extra: Using index (Filesort ì—†ìŒ)
```

**í™œìš© íŒ**
- ìµœì‹  ë°ì´í„°ë¥¼ ìì£¼ ì¡°íšŒí•˜ëŠ” ê²½ìš°: DESC ì¸ë±ìŠ¤ ê³ ë ¤
- ë³µí•© ì¸ë±ìŠ¤ì—ì„œ ì»¬ëŸ¼ë³„ë¡œ ASC/DESC ì§€ì • ê°€ëŠ¥
  ```sql
  CREATE INDEX idx_user_created
  ON tb_user(name ASC, created_at DESC);
  -- name ì˜¤ë¦„ì°¨ìˆœ â†’ ê°™ì€ name ë‚´ì—ì„œ created_at ë‚´ë¦¼ì°¨ìˆœ
  ```

### 2-9. í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ vs ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤

MySQL InnoDBëŠ” ë‘ ê°€ì§€ ì¢…ë¥˜ì˜ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

**1. í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ (Clustered Index) = PK ì¸ë±ìŠ¤**

```
êµ¬ì¡°:
[Root/Branch Nodes]
        â†“
[Leaf Nodes] â† ì‹¤ì œ í…Œì´ë¸” ë°ì´í„°ê°€ ì—¬ê¸°ì— ì €ì¥ë¨!
  (PK, ëª¨ë“  ì»¬ëŸ¼ ë°ì´í„°)
```

**íŠ¹ì§•**
- **í…Œì´ë¸”ë‹¹ 1ê°œë§Œ ì¡´ì¬** (PK ê¸°ì¤€)
- ë¦¬í”„ ë…¸ë“œì— **ì‹¤ì œ í…Œì´ë¸”ì˜ ëª¨ë“  ë°ì´í„°**ê°€ ì €ì¥ë¨
- PK ìˆœì„œëŒ€ë¡œ ë¬¼ë¦¬ì ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ì €ì¥
- PKë¡œ ì¡°íšŒ ì‹œ **ë§¤ìš° ë¹ ë¦„** (ì¸ë±ìŠ¤ ì¡°íšŒ = ë°ì´í„° ì¡°íšŒ)

```sql
-- PKë¡œ ì¡°íšŒ ì‹œ: í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ë§Œ íƒìƒ‰
SELECT * FROM tb_payment WHERE id = 100;
-- 1ë‹¨ê³„: í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤(PK)ì—ì„œ id=100 ì°¾ê¸°
-- 2ë‹¨ê³„: ë¦¬í”„ ë…¸ë“œì— ëª¨ë“  ë°ì´í„°ê°€ ìˆìŒ â†’ ì¦‰ì‹œ ë°˜í™˜ âœ…
```

**2. ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ (Secondary Index) = ì¼ë°˜ ì¸ë±ìŠ¤**

```
êµ¬ì¡°:
[Root/Branch Nodes]
        â†“
[Leaf Nodes] â† PK ê°’ë§Œ ì €ì¥ë¨
  (ì¸ë±ìŠ¤ ì»¬ëŸ¼ ê°’, PK)
```

**íŠ¹ì§•**
- í…Œì´ë¸”ë‹¹ **ì—¬ëŸ¬ ê°œ ìƒì„± ê°€ëŠ¥**
- ë¦¬í”„ ë…¸ë“œì— **ì¸ë±ìŠ¤ ì»¬ëŸ¼ ê°’ + PK**ë§Œ ì €ì¥
- ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ **PKë¡œ í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ë¥¼ ë‹¤ì‹œ ì¡°íšŒ**í•´ì•¼ í•¨

```sql
-- ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ë¡œ ì¡°íšŒ ì‹œ: 2ë‹¨ê³„ ì¡°íšŒ
CREATE INDEX idx_company_name ON tb_payment(company_name);

SELECT * FROM tb_payment WHERE company_name LIKE 'apple%';
-- 1ë‹¨ê³„: ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤(idx_company_name)ì—ì„œ 'apple'ë¡œ ì‹œì‘í•˜ëŠ” PK ëª©ë¡ ì¶”ì¶œ
--        ì˜ˆ: [101, 523, 1247, ..., 98234]
-- 2ë‹¨ê³„: ì¶”ì¶œí•œ PKë¡œ í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ì—ì„œ ì‹¤ì œ ë°ì´í„° ì¡°íšŒ (Random I/O ë°œìƒ) âš ï¸
```

**3. ë‘ ì¸ë±ìŠ¤ë¥¼ í•¨ê»˜ ì‚¬ìš©í•  ë•Œì˜ ë™ì‘ ë°©ì‹**

```sql
SELECT *
FROM tb_payment
WHERE company_name = 'apple';
```

**ì‹¤í–‰ ê³¼ì • (ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ â†’ í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤)**

```
Step 1: ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤(idx_company_name) íƒìƒ‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   idx_company_name (B+Tree)    â”‚
â”‚                                 â”‚
â”‚  Root/Branch: íƒìƒ‰ ê²½ë¡œ         â”‚
â”‚         â†“                       â”‚
â”‚  Leaf Nodes:                    â”‚
â”‚  ('apple', PK=101)            â”‚
â”‚  ('apple', PK=523)            â”‚  â† PK ëª©ë¡ ì¶”ì¶œ
â”‚  ('apple', PK=1247)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ PK ë¦¬ìŠ¤íŠ¸: [101, 523, 1247]

Step 2: í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤(PK)ë¡œ ì‹¤ì œ ë°ì´í„° ì¡°íšŒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Clustered Index (B+Tree)     â”‚
â”‚                                 â”‚
â”‚  Root/Branch: PKë¡œ íƒìƒ‰         â”‚
â”‚         â†“                       â”‚
â”‚  Leaf Nodes (ì‹¤ì œ ë°ì´í„°):       â”‚
â”‚  PK=101 â†’ (101, 'apple', ...) â”‚ â† Random I/O
â”‚  PK=523 â†’ (523, 'apple', ...) â”‚ â† Random I/O
â”‚  PK=1247 â†’ (1247, 'apple', ...)â”‚ â† Random I/O
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ í¬ì¸íŠ¸**
- ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ì˜ ë¦¬í”„ ë…¸ë“œëŠ” **PKë§Œ ì €ì¥** (ì‹¤ì œ ë°ì´í„° ì—†ìŒ)
- ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ ì¡°íšŒ í›„ **ë°˜ë“œì‹œ í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ë¥¼ ë‹¤ì‹œ ì¡°íšŒ**í•´ì•¼ í•¨
- ì´ ê³¼ì •ì—ì„œ **Random I/O ë°œìƒ** â†’ ì„±ëŠ¥ ì €í•˜ì˜ ì£¼ìš” ì›ì¸
- Random I/Oê°€ ë§ì„ìˆ˜ë¡ ì„±ëŠ¥ ì €í•˜ â†’ **ì»¤ë²„ë§ ì¸ë±ìŠ¤ê°€ ì¤‘ìš”í•œ ì´ìœ **

**ë°œí‘œ ë©˜íŠ¸**

"MySQL InnoDBëŠ” B+Treeë¼ëŠ” ìë£Œêµ¬ì¡°ë¡œ ì¸ë±ìŠ¤ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.

B+TreeëŠ” ì„¸ ê°€ì§€ ë…¸ë“œë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ë£¨íŠ¸ì™€ ë¸Œëœì¹˜ ë…¸ë“œëŠ” í‚¤ ê°’ë§Œ ì €ì¥í•˜ì—¬ íƒìƒ‰ ê²½ë¡œë¥¼ ì œê³µí•˜ê³ , ë¦¬í”„ ë…¸ë“œëŠ” ì‹¤ì œ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

ë¦¬í”„ ë…¸ë“œëŠ” Linked Listë¡œ ì—°ê²°ë˜ì–´ ìˆì–´ ë²”ìœ„ ê²€ìƒ‰ì— ë§¤ìš° íš¨ìœ¨ì ì…ë‹ˆë‹¤.

**ì—¬ê¸°ì„œ ì •ë§ ì¤‘ìš”í•œ íŠ¹ì„±ì´ ìˆìŠµë‹ˆë‹¤.**

ì¸ë±ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì™¼ìª½ë¶€í„° ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.

ì´ íŠ¹ì„±ì´ ì™œ ì¤‘ìš”í• ê¹Œìš”?

ì²«ì§¸, ë²”ìœ„ ê²€ìƒ‰ì´ ë§¤ìš° íš¨ìœ¨ì ì…ë‹ˆë‹¤. '1ì›” 1ì¼ë¶€í„° 1ì›” 31ì¼ê¹Œì§€'ë¥¼ ê²€ìƒ‰í•˜ë©´, ì‹œì‘ì ì„ ì°¾ê³  ìˆœì°¨ì ìœ¼ë¡œ ì½ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

ë‘˜ì§¸, ORDER BYê°€ ì¸ë±ìŠ¤ ìˆœì„œì™€ ì¼ì¹˜í•˜ë©´ ì¶”ê°€ ì •ë ¬ ì‘ì—…ì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ ì •ë ¬ë˜ì–´ ìˆìœ¼ë‹ˆê¹Œìš”.

ì°¸ê³ ë¡œ MySQL 8.0ë¶€í„°ëŠ” ì—­ì¸ë±ìŠ¤, ì¦‰ DESC ì¸ë±ìŠ¤ë„ ì§€ì›í•©ë‹ˆë‹¤. ìµœì‹  ë°ì´í„°ë¥¼ ìì£¼ ì¡°íšŒí•˜ëŠ” ê²½ìš° ë‚´ë¦¼ì°¨ìˆœ ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ë©´ ì„±ëŠ¥ì´ ë” ì¢‹ì•„ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë§ˆì§€ë§‰ìœ¼ë¡œ ë§¤ìš° ì¤‘ìš”í•œ ê°œë…, í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ì™€ ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ì˜ ì°¨ì´ì…ë‹ˆë‹¤.**

MySQL InnoDBëŠ” ë‘ ì¢…ë¥˜ì˜ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

ì²«ì§¸, í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤. ì´ê²ƒì€ PK ê¸°ë°˜ ì¸ë±ìŠ¤ë¡œ, í…Œì´ë¸”ë‹¹ 1ê°œë§Œ ì¡´ì¬í•©ë‹ˆë‹¤. ë¦¬í”„ ë…¸ë“œì— ì‹¤ì œ í…Œì´ë¸”ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì €ì¥ë˜ì–´ ìˆì–´ì„œ, PKë¡œ ì¡°íšŒí•  ë•ŒëŠ” ë§¤ìš° ë¹ ë¦…ë‹ˆë‹¤. ì¸ë±ìŠ¤ ì¡°íšŒê°€ ê³§ ë°ì´í„° ì¡°íšŒë‹ˆê¹Œìš”.

ë‘˜ì§¸, ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤. ìš°ë¦¬ê°€ ë§Œë“  company_name ì¸ë±ìŠ¤ê°€ ë°”ë¡œ ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤. ì´ ì¸ë±ìŠ¤ì˜ ë¦¬í”„ ë…¸ë“œì—ëŠ” ì‹¤ì œ ë°ì´í„°ê°€ ì—†ê³  PKë§Œ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ë¡œ ì¡°íšŒí•˜ë©´ 2ë‹¨ê³„ë¥¼ ê±°ì³ì•¼ í•©ë‹ˆë‹¤.

1ë‹¨ê³„: ì„¸ì»¨ë”ë¦¬ ì¸ë±ìŠ¤ì—ì„œ ì¡°ê±´ì— ë§ëŠ” PK ëª©ë¡ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
2ë‹¨ê³„: ì¶”ì¶œí•œ PKë¡œ í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ë¥¼ ë‹¤ì‹œ ì¡°íšŒí•´ì„œ ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

ì´ 2ë‹¨ê³„ ê³¼ì •ì—ì„œ Random I/Oê°€ ë°œìƒí•©ë‹ˆë‹¤. Random I/Oê°€ ë§ì„ìˆ˜ë¡ ì„±ëŠ¥ì´ ë–¨ì–´ì§€ê¸° ë•Œë¬¸ì—, ì¸ë±ìŠ¤ ì„¤ê³„ ì‹œ ì´ë¥¼ ìµœì†Œí™”í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ë‚˜ì¤‘ì— ì„¤ëª…í•  ì»¤ë²„ë§ ì¸ë±ìŠ¤ê°€ ì¤‘ìš”í•œ ê²ë‹ˆë‹¤.

ì´ì œ ë‹¨ì¼ ì¸ë±ìŠ¤ë¡œëŠ” í•´ê²°í•  ìˆ˜ ì—†ëŠ” ë” ë³µì¡í•œ ì¼€ì´ìŠ¤ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤."

## 3. ì¸ë±ìŠ¤ ì„¤ê³„ (10ë¶„)

### 3-1. ë³µí•© ì¡°ê±´ ê²€ìƒ‰ê³¼ ë‹¨ì¼ ì¸ë±ìŠ¤ì˜ í•œê³„

**ì‹œë‚˜ë¦¬ì˜¤**: ì‚¬ìš©ì ì´ë¦„ + ìƒíƒœë¡œ ê²€ìƒ‰

```sql
-- ì‚¬ìš©ì ì´ë¦„ê³¼ ìƒíƒœë¡œ ê²€ìƒ‰
SELECT * FROM tb_user
WHERE name = 'gmoon'
  AND status = 'ACTIVE';
```

### 3-2. ë³µí•© ì¸ë±ìŠ¤ ì„¤ê³„ ì›ì¹™

**í˜„ì¬ ì¸ë±ìŠ¤ ìƒí™©**
```sql
-- name ì¸ë±ìŠ¤ë§Œ ìˆëŠ” ìƒíƒœ
CREATE INDEX idx_name ON tb_user(name);
```

**EXPLAIN ê²°ê³¼**
```sql
EXPLAIN SELECT * FROM tb_user WHERE name = 'gmoon' AND status = 'ACTIVE';
```

**ê²°ê³¼ ë¶„ì„**
- `key: idx_name` â†’ name ì¸ë±ìŠ¤ëŠ” ì‚¬ìš©
- nameìœ¼ë¡œ í•„í„°ë§í•œ í›„ statusëŠ” í…Œì´ë¸”ì—ì„œ ì¬í•„í„°ë§
- status ì¡°ê±´ì€ ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ì§€ ëª»í•¨

**ë¬¸ì œì **
- nameìœ¼ë¡œ 1000ê±´ì„ ì°¾ì•˜ë‹¤ë©´, 1000ê±´ ëª¨ë‘ í…Œì´ë¸”ì—ì„œ ì½ì–´ì„œ statusë¥¼ í™•ì¸
- ë¶ˆí•„ìš”í•œ Random I/O ë°œìƒ

**ë³µí•© ì¸ë±ìŠ¤ ìƒì„±**

**ë³µí•© ì¸ë±ìŠ¤ ìƒì„±**
```sql
-- ì—¬ëŸ¬ ì»¬ëŸ¼ì„ ì¡°í•©í•œ ì¸ë±ìŠ¤
CREATE INDEX idx_name_status ON tb_user(name, status);
```

**EXPLAIN ì¬í™•ì¸**
```sql
EXPLAIN SELECT * FROM tb_user WHERE name = 'gmoon' AND status = 'ACTIVE';
```

**ê°œì„  ê²°ê³¼**
- ë‘ ì¡°ê±´ ëª¨ë‘ ì¸ë±ìŠ¤ì—ì„œ í•„í„°ë§
- ìµœì¢… ê²°ê³¼ì— í•´ë‹¹í•˜ëŠ” Rowë§Œ í…Œì´ë¸” ì ‘ê·¼
- Random I/O ëŒ€í­ ê°ì†Œ

**ë³µí•© ì¸ë±ìŠ¤ í•µì‹¬ ì›ì¹™**

**ë³µí•© ì¸ë±ìŠ¤ (Composite Index)**
```sql
CREATE INDEX idx_user_status_date ON tb_user(name, status, created_at);
```
- ì—¬ëŸ¬ ì»¬ëŸ¼ì„ ì¡°í•©í•œ ì¸ë±ìŠ¤
- **ì„ í–‰ ì»¬ëŸ¼ ìˆœì„œê°€ ë§¤ìš° ì¤‘ìš”**

**1. ì„ í–‰ ì»¬ëŸ¼ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥**

ì „í™”ë²ˆí˜¸ë¶€ë¥¼ ìƒê°í•´ë³´ì„¸ìš”
- ì„± â†’ ì´ë¦„ ìˆœìœ¼ë¡œ ì •ë ¬
- ì„±ì„ ì•Œë©´ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆì§€ë§Œ
- ì´ë¦„ë§Œ ì•Œë©´ ì°¾ì„ ìˆ˜ ì—†ìŒ

```sql
-- ì¸ë±ìŠ¤: (name, status, created_at)

-- âœ… nameë§Œ ì‚¬ìš©
WHERE name = ?

-- âœ… name + status ì‚¬ìš©
WHERE name = ? AND status = ?

-- âœ… name + status + created_at ëª¨ë‘ ì‚¬ìš©
WHERE name = ? AND status = ? AND created_at > ?

-- âŒ ì„ í–‰ ì»¬ëŸ¼(name) ì—†ìŒ - ì¸ë±ìŠ¤ ì‚¬ìš© ë¶ˆê°€
WHERE status = ?

-- âŒ ì¤‘ê°„ ê±´ë„ˆëœ€ - statusëŠ” ì¸ë±ìŠ¤ ì‚¬ìš© ë¶ˆê°€
WHERE name = ? AND created_at > ?
```

**2. ë²”ìœ„ ì¡°ê±´(>, <, BETWEEN) ì´í›„ ì»¬ëŸ¼ì€ ì¸ë±ìŠ¤ ì‚¬ìš© ë¶ˆê°€**

```sql
-- ì¸ë±ìŠ¤: (name, status, created_at)

-- ì¿¼ë¦¬
WHERE name = ? AND created_at > ? AND status = ?

-- ì‹¤ì œ ì¸ë±ìŠ¤ í™œìš©
- name: âœ… ì‚¬ìš© (ë™ë“± ì¡°ê±´)
- created_at: âœ… ë²”ìœ„ ê²€ìƒ‰ê¹Œì§€ ì‚¬ìš©
- status: âŒ ì‚¬ìš© ë¶ˆê°€ (ë²”ìœ„ ì¡°ê±´ ì´í›„)
```

**ì™œ ì´ëŸ° í˜„ìƒì´ ë°œìƒí• ê¹Œ?**

ë³µí•© ì¸ë±ìŠ¤ëŠ” **ì™¼ìª½ ì»¬ëŸ¼ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ì •ë ¬**ë˜ì–´ ìˆê¸° ë•Œë¬¸

```
ì¸ë±ìŠ¤ ì •ë ¬ ìˆœì„œ: (name, status, created_at)

1. name ê¸°ì¤€ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
2. ê°™ì€ name ë‚´ì—ì„œ status ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
3. ê°™ì€ name, status ë‚´ì—ì„œ created_at ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬

ì˜ˆì‹œ:
('gmoon', 'ACTIVE', '2024-01-01')
('gmoon', 'ACTIVE', '2024-01-02')
('gmoon', 'INACTIVE', '2024-01-01')
('hongkd', 'ACTIVE', '2024-01-01')
```

ë²”ìœ„ ì¡°ê±´ì„ ì‚¬ìš©í•˜ë©´ ê·¸ ì´í›„ ì •ë ¬ì€ ê¹¨ì§„ë‹¤
```sql
WHERE name = 'gmoon' AND created_at > '2024-01-01'

-- name = 'gmoon'ê¹Œì§€ëŠ” ì •ë ¬ëœ ìƒíƒœ
-- í•˜ì§€ë§Œ created_at > '2024-01-01'ë¡œ ë²”ìœ„ë¥¼ ì„ íƒí•˜ë©´
-- ê·¸ ì•ˆì—ì„œ statusëŠ” ì •ë ¬ë˜ì§€ ì•Šì€ ìƒíƒœ
```

### 3-3. ì„ íƒë„(Selectivity) - ì¢‹ì€ ì¸ë±ìŠ¤ì˜ ì¡°ê±´

**ì„ íƒë„ = ì „ì²´ ë°ì´í„° ì¤‘ íŠ¹ì • ê°’ìœ¼ë¡œ ì–¼ë§ˆë‚˜ í•„í„°ë§ë˜ëŠ”ê°€**

**ë†’ì€ ì„ íƒë„ (ì¢‹ì€ ì¸ë±ìŠ¤)**
- ì˜ˆ: `email`, `ì£¼ë¬¸ë²ˆí˜¸`, `user_id`
- ê°’ì´ ê³ ìœ í•˜ê±°ë‚˜ ë‹¤ì–‘í•¨ â†’ í•„í„°ë§ íš¨ê³¼ ë†’ìŒ
- ì¸ë±ìŠ¤ íš¨ìœ¨ì„± â¬†ï¸

**ë‚®ì€ ì„ íƒë„ (ë‚˜ìœ ì¸ë±ìŠ¤)**
- ì˜ˆ: `gender` (ë‚¨/ì—¬), `status` (í™œì„±/ë¹„í™œì„±)
- ê°’ì´ ëª‡ ê°œë¡œ í•œì • â†’ í•„í„°ë§ íš¨ê³¼ ë‚®ìŒ
- ì¸ë±ìŠ¤ íš¨ìœ¨ì„± â¬‡ï¸

**ì„ íƒë„ ê³„ì‚° ë°©ë²• (ë¶„í¬ë„)**

```sql
-- ì»¬ëŸ¼ì˜ ì„ íƒë„(ë¶„í¬ë„) ê³„ì‚°
SELECT COUNT(DISTINCT name) / COUNT(*) * 100 AS index_selectivity
FROM tb_user;
```

**ë¶„í¬ë„ = (ì»¬ëŸ¼ ê³ ìœ  ê°’ ROW ìˆ˜) / (í…Œì´ë¸”ì˜ ì´ ROW ìˆ˜) * 100**

- **80-90% ì´ìƒ**: ë§¤ìš° ì¢‹ìŒ âœ…
  - ì¸ë±ìŠ¤ê°€ ëŒ€ë¶€ë¶„ì˜ ê°’ë“¤ì— ëŒ€í•´ ê³ ë¥´ê²Œ ë¶„í¬
  - ì¿¼ë¦¬ ì„±ëŠ¥ ìµœì í™”

- **60-80%**: ì—¬ì „íˆ ê´œì°®ìŒ ğŸ‘
  - ëŒ€ë¶€ë¶„ì˜ ì¿¼ë¦¬ê°€ íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰
  - íŠ¹ì • ê²½ìš° ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„±

- **50-60% ì´í•˜**: ì¸ë±ìŠ¤ íš¨ìœ¨ì„± ì €í•˜ âš ï¸
  - íŠ¹ì • ê°’ì— ë°ì´í„° ì§‘ì¤‘
  - ì¿¼ë¦¬ ì„±ëŠ¥ì— ë¶€ì •ì  ì˜í–¥

**ì£¼ì˜: ë°ì´í„° ë¶„í¬ ë¶ˆê· í˜•**

ë¶„í¬ë„ê°€ ê´œì°®ì•„ ë³´ì—¬ë„ ë°ì´í„° ë¶„í¬ê°€ ë¶ˆê· í˜•í•˜ë©´ ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ì§€ ì•ŠëŠ” ê²Œ ë‚˜ì„ ìˆ˜ ìˆë‹¤.

```
ì˜ˆì‹œ:
- ì „ì²´ row ìˆ˜ = 1,000ë§Œ
- íŠ¹ì • ì»¬ëŸ¼ ê³ ìœ  ê°’ ìˆ˜ = 10ë§Œ
- ë¶„í¬ë„ = 1% (10ë§Œ / 1,000ë§Œ * 100)

â†’ ë¶„í¬ë„ê°€ ë‚®ì•„ ì¸ë±ìŠ¤ ì¶”ê°€ ì‹œ ì˜¤íˆë ¤ ì˜¤ë²„í—¤ë“œ ë°œìƒ ê°€ëŠ¥
```

**ë³µí•© ì¸ë±ìŠ¤ ì„¤ê³„ íŒ**
- **ì›ì¹™**: ì¹´ë””ë„ë¦¬í‹°(ì„ íƒë„) ë†’ì€ ì»¬ëŸ¼ì„ ì•ì— ë°°ì¹˜
- ë‹¨, **ì‹¤ì œ ì¿¼ë¦¬ íŒ¨í„´ì„ ìµœìš°ì„  ê³ ë ¤**
- ê°±ì‹ ì´ ìì£¼ ë˜ì§€ ì•ŠëŠ” ì»¬ëŸ¼ ì„ íƒ
- ì¡°ì¸ì ˆì— ì—°ê²°ë˜ëŠ” ì»¬ëŸ¼ ìš°ì„ 
- ì •ë ¬ì— ì‚¬ìš©ë˜ëŠ” ì»¬ëŸ¼ ê³ ë ¤

**âš ï¸ ì¹´ë””ë„ë¦¬í‹° ì˜ˆì™¸ ì „ëµ**

ì¼ë°˜ì ìœ¼ë¡œ ì¹´ë””ë„ë¦¬í‹°ê°€ ë†’ì€ ì»¬ëŸ¼ì„ ì•ì— ë°°ì¹˜í•˜ì§€ë§Œ, **IN ì ˆì„ Boolean ì»¬ëŸ¼ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì¤‘ê°„ì— ë°°ì¹˜**í•˜ë©´ ì„±ëŠ¥ì„ í¬ê²Œ ê°œì„ í•  ìˆ˜ ìˆë‹¤.

```sql
-- âŒ IN ì ˆ ì‚¬ìš©: Binary Search O(log n)
INDEX(user_id, created_at)
WHERE user_id = ? AND user_type IN ('FREE', 'TRIAL', 'BASIC') AND created_at > ?

-- âœ… Boolean ë³€í™˜: Equality O(1)
INDEX(user_id, is_free_license_user, created_at)
WHERE user_id = ? AND is_free_license_user = true AND created_at > ?
-- ëª¨ë“  ì»¬ëŸ¼ì´ ì¸ë±ìŠ¤ í™œìš© + IN ì ˆë³´ë‹¤ ë¹ ë¦„!
```

**í•µì‹¬ í¬ì¸íŠ¸**
- IN ì ˆ (Binary Search) â†’ Boolean Equality (ë” ë¹ ë¦„)
- ë³µí•© ì¸ë±ìŠ¤ì—ì„œ Booleanì˜ ë‚®ì€ ì¹´ë””ë„ë¦¬í‹°ëŠ” ë¬¸ì œ ì•ˆ ë¨
- ë°ì´í„° ë¶„í¬ê°€ **5-10% vs 90-95%ë¡œ í¸í–¥**ëœ ê²½ìš° íŠ¹íˆ íš¨ê³¼ì 
- ìì„¸í•œ ì„¤ëª…: Chapter 7-1 í¬ì¸íŠ¸ 11 ì°¸ê³ 

**ë°œí‘œ ë©˜íŠ¸**

"ë‹¨ì¼ ì¸ë±ìŠ¤ë¡œëŠ” í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰í•  ë•ŒëŠ” ë³µí•© ì¸ë±ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ë³µí•© ì¸ë±ìŠ¤ì˜ í•µì‹¬ì€ ì„ í–‰ ì»¬ëŸ¼ ìˆœì„œì…ë‹ˆë‹¤. ì „í™”ë²ˆí˜¸ë¶€ì²˜ëŸ¼ ì™¼ìª½ ì»¬ëŸ¼ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, ì¤‘ê°„ì„ ê±´ë„ˆë›°ë©´ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

íŠ¹íˆ ë²”ìœ„ ì¡°ê±´ì´ ë“±ì¥í•˜ë©´ ê·¸ ì´í›„ ì»¬ëŸ¼ì€ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ì ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

ë˜í•œ ì„ íƒë„ê°€ ë†’ì€ ì»¬ëŸ¼, ì¦‰ ê³ ìœ í•œ ê°’ì´ ë§ì€ ì»¬ëŸ¼ì„ ì•ì— ë°°ì¹˜í•´ì•¼ í•„í„°ë§ íš¨ê³¼ê°€ ì¢‹ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì œ ì¿¼ë¦¬ íŒ¨í„´ì´ ë” ì¤‘ìš”í•˜ë¯€ë¡œ, í†µê³„ë³´ë‹¤ëŠ” ì‹¤ì œ ì‚¬ìš© ë¹ˆë„ë¥¼ ìš°ì„  ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ì œ ë” ê³ ê¸‰ ìµœì í™” ê¸°ë²•ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤."

### 3-4. ì»¤ë²„ë§ ì¸ë±ìŠ¤ (Covering Index) - ìµœê³ ì˜ ìµœì í™”

**ì»¤ë²„ë§ ì¸ë±ìŠ¤ = ì¸ë±ìŠ¤ë§Œìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì™„ì „íˆ ì²˜ë¦¬ ê°€ëŠ¥í•œ ìƒíƒœ**

**ì¼ë°˜ ì¸ë±ìŠ¤ì˜ ë™ì‘**
```sql
-- ì¸ë±ìŠ¤
CREATE INDEX idx_name ON tb_user(name);

-- ì¿¼ë¦¬
SELECT name, amount, created_at
FROM tb_user
WHERE name = 100;

-- ë™ì‘ ê³¼ì •
1. ì¸ë±ìŠ¤ì—ì„œ name = 100ì¸ PK ì°¾ê¸°
2. PKë¡œ í…Œì´ë¸” ì ‘ê·¼í•˜ì—¬ amount, created_at ì¡°íšŒ (Random I/O ë°œìƒ)
```

**ì»¤ë²„ë§ ì¸ë±ìŠ¤ì˜ ë™ì‘**
```sql
-- ì»¤ë²„ë§ ì¸ë±ìŠ¤
CREATE INDEX idx_covering ON tb_user(name, amount, created_at);

-- ê°™ì€ ì¿¼ë¦¬
SELECT name, amount, created_at
FROM tb_user
WHERE name = 100;

-- ë™ì‘ ê³¼ì •
1. ì¸ë±ìŠ¤ì—ì„œ name = 100 ì°¾ê¸°
2. ì¸ë±ìŠ¤ì— amount, created_atì´ ëª¨ë‘ ìˆìŒ
3. í…Œì´ë¸” ì ‘ê·¼ ë¶ˆí•„ìš”! (Random I/O ì œê±°)
```

**ì¥ì **
- í…Œì´ë¸” ë°ì´í„° í˜ì´ì§€ ì ‘ê·¼ ë¶ˆí•„ìš” â†’ Random I/O ì œê±°
- ê°€ì¥ ë¹ ë¥¸ ì¿¼ë¦¬ ì„±ëŠ¥

**EXPLAINì—ì„œ í™•ì¸**
- `Extra: Using index` â†’ ì»¤ë²„ë§ ì¸ë±ìŠ¤ ì‚¬ìš© ì¤‘

**ì‹¤ì „ í™œìš©**
```sql
-- í˜ì´ì§€ë„¤ì´ì…˜ ìµœì í™”
-- ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¡œ PKë§Œ ë¹ ë¥´ê²Œ ì¡°íšŒ í›„, í•„ìš”í•œ ë°ì´í„°ë§Œ ë³„ë„ ì¡°íšŒ
SELECT *
FROM tb_user
WHERE id IN (
    SELECT id  -- ì»¤ë²„ë§ ì¸ë±ìŠ¤ í™œìš©
    FROM tb_user
    WHERE status = 'ACTIVE'
    ORDER BY created_at DESC
    LIMIT 20
);
```

### 3-5. ì •ë ¬(ORDER BY)ê³¼ ì¸ë±ìŠ¤

**ì¸ë±ìŠ¤ë¥¼ í™œìš©í•œ ì •ë ¬**
- ì¸ë±ìŠ¤ëŠ” ì´ë¯¸ ì •ë ¬ëœ ìƒíƒœë¡œ ì €ì¥ë¨
- ORDER BY ì»¬ëŸ¼ì´ ì¸ë±ìŠ¤ ìˆœì„œì™€ ì¼ì¹˜í•˜ë©´ ì •ë ¬ ì‘ì—… ìƒëµ ê°€ëŠ¥

```sql
CREATE INDEX idx_created ON tb_user(created_at);
SELECT * FROM tb_user ORDER BY created_at;
-- ì¸ë±ìŠ¤ ìˆœì„œ ê·¸ëŒ€ë¡œ ì½ìœ¼ë©´ ë˜ë¯€ë¡œ ì¶”ê°€ ì •ë ¬ ë¶ˆí•„ìš”
```

**Filesort ë°œìƒ ì¡°ê±´**
- ORDER BY ì»¬ëŸ¼ì´ ì¸ë±ìŠ¤ì— ì—†ëŠ” ê²½ìš°
- WHERE ì¡°ê±´ê³¼ ORDER BY ì»¬ëŸ¼ì˜ ì¸ë±ìŠ¤ ìˆœì„œê°€ ë‹¤ë¥¸ ê²½ìš°
- Filesort = ë©”ëª¨ë¦¬ ë˜ëŠ” ë””ìŠ¤í¬ì—ì„œ ë³„ë„ ì •ë ¬ ì‘ì—… ìˆ˜í–‰ â†’ ëŠë¦¼

**ë³µí•© ì¸ë±ìŠ¤ì™€ ORDER BY**
```sql
-- ì¸ë±ìŠ¤: (status, created_at)
CREATE INDEX idx_status_date ON tb_user(status, created_at);

-- âœ… ì¸ë±ìŠ¤ í™œìš© (Filesort ì—†ìŒ)
WHERE status = 'ACTIVE' ORDER BY created_at

-- âŒ Filesort ë°œìƒ
WHERE status = 'ACTIVE' ORDER BY name

-- âŒ Filesort ë°œìƒ (ì¸ë±ìŠ¤ ìˆœì„œì™€ ë‹¤ë¦„)
ORDER BY created_at, status
```

**ë°œí‘œ ë©˜íŠ¸**

"ì»¤ë²„ë§ ì¸ë±ìŠ¤ëŠ” ì¿¼ë¦¬ê°€ í•„ìš”ë¡œ í•˜ëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ ì¸ë±ìŠ¤ì—ì„œ ë°”ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìƒíƒœë¥¼ ë§í•©ë‹ˆë‹¤.

í…Œì´ë¸” ë°ì´í„° í˜ì´ì§€ì— ì ‘ê·¼í•  í•„ìš”ê°€ ì—†ì–´ Random I/Oë¥¼ ì™„ì „íˆ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ì¥ ë¹ ë¥¸ ì¿¼ë¦¬ ì„±ëŠ¥ì„ ë³´ì¥í•˜ëŠ” ë°©ë²•ì´ì£ .

EXPLAIN ê²°ê³¼ì—ì„œ Extraì— 'Using index'ê°€ í‘œì‹œë˜ë©´ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

ì •ë ¬ ìµœì í™”ë„ ì¤‘ìš”í•©ë‹ˆë‹¤. ì¸ë±ìŠ¤ëŠ” ì´ë¯¸ ì •ë ¬ëœ ìƒíƒœë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì—, ORDER BYê°€ ì¸ë±ìŠ¤ ìˆœì„œì™€ ì¼ì¹˜í•˜ë©´ ë³„ë„ ì •ë ¬ ì‘ì—…ì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤.

ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Filesortë¼ëŠ” ì¶”ê°€ ì •ë ¬ ì‘ì—…ì´ ë°œìƒí•˜ì—¬ ì„±ëŠ¥ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ MySQL ì˜µí‹°ë§ˆì´ì €ëŠ” ì´ëŸ° ì¸ë±ìŠ¤ë“¤ì„ ì–´ë–»ê²Œ ì„ íƒí• ê¹Œìš”?"

## 4. ì˜µí‹°ë§ˆì´ì € ì´í•´ (5ë¶„)

### 4-1. ë¹„ìš© ê¸°ë°˜ ì˜µí‹°ë§ˆì´ì € (CBO) - ì¸ë±ìŠ¤ë¥¼ ì„ íƒí•˜ëŠ” ì£¼ì²´

**í•µì‹¬ ê°œë…**

ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš, ì¦‰ ì–´ë–¤ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í• ì§€ëŠ” **ì˜µí‹°ë§ˆì´ì €ê°€ ì„ ì •**í•œë‹¤.

MySQL 8 ë²„ì „ì€ **"ë¹„ìš© ê¸°ë°˜ ì˜µí‹°ë§ˆì´ì €"(Cost-Based Optimizer, CBO)** ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤.

**CBOì˜ ë™ì‘ ë°©ì‹**

```
ì‚¬ìš©ì ì¿¼ë¦¬ ì…ë ¥
    â†“
ì˜µí‹°ë§ˆì´ì €ê°€ í›„ë³´ ì‹¤í–‰ ê³„íš ë„ì¶œ
    â†“
ê° ì‹¤í–‰ ê³„íšì˜ ì˜ˆìƒ ë¹„ìš© ê³„ì‚° (í†µê³„ ì •ë³´ ê¸°ë°˜)
    â†“
ê°€ì¥ ë‚®ì€ ë¹„ìš©ì˜ ì‹¤í–‰ ê³„íš ì„ íƒ
    â†“
ì¿¼ë¦¬ ì‹¤í–‰
```

**CBOê°€ ì‚¬ìš©í•˜ëŠ” í†µê³„ ì •ë³´**
- **ë°ì´í„°ëŸ‰**: í…Œì´ë¸”ì˜ ì „ì²´ Row ìˆ˜
- **ì»¬ëŸ¼ ê°’ì˜ ìˆ˜**: íŠ¹ì • ì»¬ëŸ¼ì˜ ìœ ë‹ˆí¬í•œ ê°’ ê°œìˆ˜ (Cardinality)
- **ì»¬ëŸ¼ ê°’ ë¶„í¬**: ë°ì´í„° ë¶„í¬ë„ (MySQL 8.0 íˆìŠ¤í† ê·¸ë¨)
- **ì¸ë±ìŠ¤ ë†’ì´**: B+Treeì˜ ê¹Šì´
- **í´ëŸ¬ìŠ¤í„°ë§ íŒ©í„°**: ë°ì´í„° ì €ì¥ ìˆœì„œì™€ ì¸ë±ìŠ¤ ìˆœì„œì˜ ì¼ì¹˜ ì •ë„

**ë¹„ìš© í‰ê°€ ê¸°ì¤€**
1. ì¡°ê±´ í•„í„°ë§ íš¨ê³¼ (ì„ íƒë„)
2. ì •ë ¬ ëŒ€ì‘ ê°€ëŠ¥ ì—¬ë¶€
3. JOIN ì¡°ê±´ ì§€ì›
4. Range vs Const ê²€ìƒ‰
5. Random I/O vs Sequential I/O ì˜ˆì¸¡

**CBO vs RBO ë¹„êµ**

| êµ¬ë¶„ | CBO (Cost-Based) | RBO (Rule-Based) |
|------|------------------|------------------|
| **ë°©ì‹** | í†µê³„ ì •ë³´ ê¸°ë°˜ ë¹„ìš© ê³„ì‚° | ë¯¸ë¦¬ ì •ì˜ëœ ê·œì¹™ ìš°ì„ ìˆœìœ„ |
| **ë™ì‘** | ë™ì ìœ¼ë¡œ ìµœì  ê²½ë¡œ ì„ íƒ | ê³ ì •ëœ ê·œì¹™ìœ¼ë¡œ ê²½ë¡œ ì„ íƒ |
| **MySQL** | MySQL 8+ (í˜„ì¬) | ê³¼ê±° ë°©ì‹ (ë” ì´ìƒ ì‚¬ìš© ì•ˆ í•¨) |
| **ì¥ì ** | ë°ì´í„° íŠ¹ì„± ë°˜ì˜, ëŒ€ìš©ëŸ‰ ì²˜ë¦¬ ì í•© | ë‹¨ìˆœí•˜ê³  ì˜ˆì¸¡ ê°€ëŠ¥ |
| **ë‹¨ì ** | í†µê³„ ì •ë³´ê°€ ë¶€ì •í™•í•˜ë©´ ì˜ëª»ëœ ì„ íƒ | ë°ì´í„° íŠ¹ì„± ë¬´ì‹œ, ë¹„íš¨ìœ¨ì  |

**RBOì˜ ì¿¼ë¦¬ ì‹¤í–‰ ìš°ì„ ìˆœìœ„ (ì°¸ê³ )**
```
1. FROM + JOIN
2. WHERE
3. GROUP BY
4. HAVING
5. SELECT
6. ORDER BY
7. LIMIT
```

**Index Dive - CBOì˜ í†µê³„ ìˆ˜ì§‘ ë°©ì‹**

CBOëŠ” ì‹¤í–‰ ê³„íšì„ ì„¸ìš¸ ë•Œ, ì‹¤ì œ í…Œì´ë¸” ë°ì´í„°ë¥¼ **ìƒ˜í”Œë§(Index Dive)** í•˜ì—¬ í†µê³„ë¥¼ í™•ì¸í•œë‹¤.

- **Index Dive**: ì¸ë±ìŠ¤ë¥¼ ì‹¤ì œë¡œ íƒìƒ‰í•˜ì—¬ ë°ì´í„° ë¶„í¬ í™•ì¸
- **ì£¼ì˜**: ìƒ˜í”Œë§ ê³¼ì •ì—ì„œ CPU ì‚¬ìš©ëŸ‰ ê¸‰ì¦ ê°€ëŠ¥
- **ëŒ€ì•ˆ**: ìƒ˜í”Œë§ ë¹„ìš©ì´ í¬ë©´ **ì¸ë±ìŠ¤ í†µê³„ ì •ë³´(Index Statistics)** ì‚¬ìš©

```sql
-- MySQL ì„¤ì •ìœ¼ë¡œ Index Dive ë™ì‘ ì œì–´
-- eq_range_index_dive_limit: IN ì ˆ ê°œìˆ˜ ì„ê³„ê°’
-- ê¸°ë³¸ê°’ì„ ì´ˆê³¼í•˜ë©´ ìƒ˜í”Œë§ ëŒ€ì‹  í†µê³„ ì •ë³´ ì‚¬ìš©
SHOW VARIABLES LIKE 'eq_range_index_dive_limit';
```

â†’ ì˜µí‹°ë§ˆì´ì € íŠœë‹ì„ í†µí•´ DB ì„±ëŠ¥ ê°œì„  ê°€ëŠ¥

### 4-2. EXPLAIN ì‹¤í–‰ ê³„íš ì½ê¸°

**EXPLAIN = MySQL ì˜µí‹°ë§ˆì´ì €ê°€ ì„ íƒí•œ ì‹¤í–‰ ê³„íšì„ ë³´ì—¬ì£¼ëŠ” ë„êµ¬**

```sql
EXPLAIN SELECT * FROM tb_user WHERE name = 100;
```

**ì£¼ìš” ì»¬ëŸ¼ í•´ì„**

**1. type - ì ‘ê·¼ ë°©ì‹ (ì„±ëŠ¥ ìˆœì„œ)**
- `const`: PKë‚˜ ìœ ë‹ˆí¬ í‚¤ë¡œ ë‹¨ì¼ row ì¡°íšŒ â†’ ê°€ì¥ ë¹ ë¦„
- `ref`: ì¸ë±ìŠ¤ë¡œ ì—¬ëŸ¬ row ì¡°íšŒ â†’ ì¢‹ìŒ
- `range`: ì¸ë±ìŠ¤ ë²”ìœ„ ìŠ¤ìº” (>, <, BETWEEN) â†’ ê´œì°®ìŒ
- `index`: ì¸ë±ìŠ¤ ì „ì²´ ìŠ¤ìº” â†’ ëŠë¦¼
- `ALL`: í…Œì´ë¸” ì „ì²´ ìŠ¤ìº” â†’ ê°€ì¥ ëŠë¦¼ âš ï¸

**2. key - ì‹¤ì œ ì‚¬ìš©ëœ ì¸ë±ìŠ¤**
- `NULL`: ì¸ë±ìŠ¤ ë¯¸ì‚¬ìš© â†’ ë¬¸ì œ ë°œìƒ âš ï¸
- ì¸ë±ìŠ¤ ì´ë¦„ í‘œì‹œ: í•´ë‹¹ ì¸ë±ìŠ¤ ì‚¬ìš© ì¤‘

**3. rows - ì˜µí‹°ë§ˆì´ì €ê°€ ì˜ˆìƒí•˜ëŠ” ê²€ìƒ‰ row ìˆ˜**
- ì ì„ìˆ˜ë¡ ì¢‹ìŒ
- ì‹¤ì œ í…Œì´ë¸” í¬ê¸° ëŒ€ë¹„ ë¹„ìœ¨ í™•ì¸

**4. Extra - ì¶”ê°€ ì •ë³´**
- `Using index`: ì»¤ë²„ë§ ì¸ë±ìŠ¤ ì‚¬ìš© â†’ ìµœê³ ì˜ ì„±ëŠ¥ âœ…
- `Using where`: WHERE ì¡°ê±´ í•„í„°ë§
- `Using filesort`: ë³„ë„ ì •ë ¬ ì‘ì—… ë°œìƒ â†’ ê°œì„  í•„ìš” âš ï¸
- `Using temporary`: ì„ì‹œ í…Œì´ë¸” ì‚¬ìš© â†’ ê°œì„  í•„ìš” âš ï¸

**ì‹¤ì „ ì˜ˆì‹œ**

```sql
-- âŒ ë‚˜ìœ ì˜ˆì‹œ
EXPLAIN SELECT * FROM tb_user WHERE DATE(created_at) = '2024-01-01';
-- ê²°ê³¼: type: ALL, key: NULL, rows: 1000000
-- ë¬¸ì œ: í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ì¸ë±ìŠ¤ ë¬´íš¨í™”, Full Scan ë°œìƒ

-- âœ… ê°œì„  ì˜ˆì‹œ
EXPLAIN SELECT * FROM tb_user
WHERE created_at >= '2024-01-01' AND created_at < '2024-01-02';
-- ê²°ê³¼: type: range, key: idx_created_at, rows: 1500
-- ê°œì„ : ì¸ë±ìŠ¤ í™œìš©, ëŒ€í­ ì„±ëŠ¥ í–¥ìƒ (1000ë°° ì´ìƒ)
```

### 4-3. í†µê³„ ì •ë³´ ê´€ë¦¬ - ANALYZE TABLE

**í†µê³„ ì •ë³´ê°€ ë¶€ì •í™•í•˜ë©´?**

CBOëŠ” í†µê³„ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¹„ìš©ì„ ê³„ì‚°í•˜ë¯€ë¡œ, **í†µê³„ê°€ ë¶€ì •í™•í•˜ë©´ ì˜ëª»ëœ ì¸ë±ìŠ¤ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤.**

**ANALYZE TABLEë¡œ í†µê³„ ì •ë³´ ê°±ì‹ **

```sql
-- íŠ¹ì • í…Œì´ë¸”ì˜ í†µê³„ ì •ë³´ ê°±ì‹ 
ANALYZE TABLE tb_user;

-- ì—¬ëŸ¬ í…Œì´ë¸” ë™ì‹œ ê°±ì‹ 
ANALYZE TABLE tb_user, users, products;
```

**ì–¸ì œ ì‹¤í–‰í•´ì•¼ í•˜ë‚˜?**
- ëŒ€ëŸ‰ ë°ì´í„° INSERT/DELETE í›„
- ì¸ë±ìŠ¤ ì¶”ê°€/ì‚­ì œ í›„
- ì¿¼ë¦¬ ì„±ëŠ¥ì´ ê°‘ìê¸° ëŠë ¤ì¡Œì„ ë•Œ
- ì •ê¸°ì ì¸ ìœ ì§€ë³´ìˆ˜ (ì˜ˆ: ì£¼ 1íšŒ)

**ì£¼ì˜ì‚¬í•­**
- âš ï¸ **Read Lock ë°œìƒ**: ì‹¤í–‰ ì¤‘ í…Œì´ë¸”ì— Read Lockì´ ê±¸ë¦¼
- âš ï¸ **ì„œë¹„ìŠ¤ ì‹œê°„ í”¼í•˜ê¸°**: íŠ¸ë˜í”½ì´ ì ì€ ìƒˆë²½ ì‹œê°„ëŒ€ ê¶Œì¥
- âš ï¸ **í° í…Œì´ë¸” ì£¼ì˜**: ë°ì´í„°ê°€ ë§ìœ¼ë©´ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼

**MySQL 8.0 íˆìŠ¤í† ê·¸ë¨**

```sql
-- íˆìŠ¤í† ê·¸ë¨ ìƒì„± (ì»¬ëŸ¼ ê°’ ë¶„í¬ ìˆ˜ì§‘)
ANALYZE TABLE tb_user UPDATE HISTOGRAM ON created_at, status;

-- íˆìŠ¤í† ê·¸ë¨ ì‚­ì œ
ANALYZE TABLE tb_user DROP HISTOGRAM ON created_at;
```

- ë” ì •í™•í•œ ë°ì´í„° ë¶„í¬ ì •ë³´ ì œê³µ
- CBOì˜ ë¹„ìš© ì˜ˆì¸¡ ì •í™•ë„ í–¥ìƒ

**ë°œí‘œ ë©˜íŠ¸**

"ì¸ë±ìŠ¤ë¥¼ ì„¤ê³„í•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•˜ì§€ë§Œ, ì‹¤ì œë¡œ ì–´ë–¤ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í• ì§€ ê²°ì •í•˜ëŠ” ê²ƒì€ ì˜µí‹°ë§ˆì´ì €ì…ë‹ˆë‹¤.

MySQL 8ì€ ë¹„ìš© ê¸°ë°˜ ì˜µí‹°ë§ˆì´ì €, CBOë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. CBOëŠ” í†µê³„ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê° ì‹¤í–‰ ê³„íšì˜ ë¹„ìš©ì„ ê³„ì‚°í•˜ì—¬ ê°€ì¥ íš¨ìœ¨ì ì¸ ê²½ë¡œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

CBOê°€ ì‚¬ìš©í•˜ëŠ” í†µê³„ ì •ë³´ì—ëŠ” ë°ì´í„°ëŸ‰, ì»¬ëŸ¼ ê°’ì˜ ìˆ˜, ë°ì´í„° ë¶„í¬, ì¸ë±ìŠ¤ ë†’ì´ ë“±ì´ ìˆìŠµë‹ˆë‹¤. ì´ ì •ë³´ê°€ ì •í™•í•´ì•¼ ì˜µí‹°ë§ˆì´ì €ê°€ ì˜¬ë°”ë¥¸ ì„ íƒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜µí‹°ë§ˆì´ì €ê°€ ì„ íƒí•œ ì‹¤í–‰ ê³„íšì„ í™•ì¸í•˜ë ¤ë©´ EXPLAINì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

ì¤‘ìš”í•œ ì»¬ëŸ¼ ë„¤ ê°€ì§€ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

typeì€ ì ‘ê·¼ ë°©ì‹ì…ë‹ˆë‹¤. constê°€ ê°€ì¥ ë¹ ë¥´ê³  ALLì´ ê°€ì¥ ëŠë¦½ë‹ˆë‹¤. typeì´ ALLì´ë©´ í…Œì´ë¸” ì „ì²´ë¥¼ ìŠ¤ìº”í•œë‹¤ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ ë°˜ë“œì‹œ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.

keyëŠ” ì‹¤ì œ ì‚¬ìš©ëœ ì¸ë±ìŠ¤ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. NULLì´ë©´ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸ë¡œ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.

rowsëŠ” MySQLì´ ì˜ˆìƒí•˜ëŠ” ê²€ìƒ‰ row ìˆ˜ì…ë‹ˆë‹¤. ì´ ìˆ«ìê°€ í¬ë©´ ì„±ëŠ¥ì´ ë–¨ì–´ì§ˆ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

ExtraëŠ” ì¶”ê°€ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. 'Using index'ëŠ” ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ì˜ë¯¸ë¡œ ìµœê³ ì˜ ì„±ëŠ¥ì…ë‹ˆë‹¤. ë°˜ë©´ 'Using filesort'ë‚˜ 'Using temporary'ê°€ ë‚˜ì˜¤ë©´ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.

íŠ¹íˆ ì£¼ì˜í•  ì ì€, WHERE ì¡°ê±´ì— í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì¸ë±ìŠ¤ê°€ ë¬´íš¨í™”ëœë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆì‹œë¥¼ ë³´ë©´ DATE í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ Full Scanì´ ë°œìƒí•˜ì§€ë§Œ, ë²”ìœ„ ì¡°ê±´ìœ¼ë¡œ ë°”ê¾¸ë©´ ì¸ë±ìŠ¤ë¥¼ íƒ€ì„œ 1000ë°° ì´ìƒ ì„±ëŠ¥ì´ í–¥ìƒë©ë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ í†µê³„ ì •ë³´ ê´€ë¦¬ì…ë‹ˆë‹¤. CBOëŠ” í†µê³„ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ë¯€ë¡œ, í†µê³„ê°€ ë¶€ì •í™•í•˜ë©´ ì˜ëª»ëœ ì¸ë±ìŠ¤ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ANALYZE TABLE ëª…ë ¹ìœ¼ë¡œ í†µê³„ ì •ë³´ë¥¼ ê°±ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ëŸ‰ ë°ì´í„° ë³€ê²½ í›„ë‚˜ ì¸ë±ìŠ¤ ì¶”ê°€/ì‚­ì œ í›„ì—ëŠ” ë°˜ë“œì‹œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¨, Read Lockì´ ë°œìƒí•˜ë¯€ë¡œ íŠ¸ë˜í”½ì´ ì ì€ ì‹œê°„ëŒ€ì— ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

ì´ì œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤ì „ íŠœë‹ ì‚¬ë¡€ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤."

## 5. ì‹¤ì „ íŠœë‹ ì‚¬ë¡€ (3ë¶„)

### 5-1. ì‹¤ì œ ê°œì„  ì‚¬ë¡€: ê´€ë¦¬ì í˜ì´ì§€ 48ì´ˆ â†’ 124ms ê°œì„ 

**ë°œí‘œ ë©˜íŠ¸**

"Chapter 1ì—ì„œ ë§ì”€ë“œë ¸ë˜ íŒŒíŠ¸ë„ˆ ì–´ë“œë¯¼ ì‚¬ì´íŠ¸ì˜ 504 íƒ€ì„ì•„ì›ƒ ì´ìŠˆ, ì‹¤ì œë¡œ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ì´ ì¿¼ë¦¬ëŠ” ìš´ì˜ ì¤‘ ë°œìƒí–ˆë˜ ìŠ¬ë¡œìš° ì¿¼ë¦¬ë¥¼ ê°œì„ í•œ ì‹¤ì œ ì‚¬ë¡€ì…ë‹ˆë‹¤. 48ì´ˆ ê±¸ë¦¬ë˜ ì¿¼ë¦¬ë¥¼ 124msë¡œ, ì•½ 387ë°° ì„±ëŠ¥ì„ ê°œì„ í–ˆìŠµë‹ˆë‹¤."

**ê°œì„ ëœ ì¿¼ë¦¬**

```sql
-- ê´€ë¦¬ì í˜ì´ì§€ ì¡°íšŒ: 48s â†’ 124ms (387ë°° ê°œì„ )
EXPLAIN
SELECT
    -- 1. ë¶ˆí•„ìš”í•œ í”„ë¡œì ì…˜ ì •ë¦¬
    team0_.id,
    team0_.type,
    team0_.status,

    -- 2. ìŠ¤ì¹¼ë¼ ì„œë¸Œ ì¿¼ë¦¬ ì ìš© (JOIN ì œê±°ë¡œ ì„±ëŠ¥ ê°œì„ )
    (SELECT user2_.name
     FROM tb_user user2_
     WHERE user2_.company_id = company0_.id
       AND role = 'ADMIN') AS col_12_0_
FROM tb_team team0_
         INNER JOIN tb_company company0_ ON team0_.company_id = company0_.id
WHERE
    -- 3. Loose Index Scan ì„¤ì • (ê°•ì œë¡œ ì¸ë±ìŠ¤ íƒ€ê²Œ í•˜ê¸°)
    (team0_.created_dt BETWEEN '1900-01-01' AND '2099-01-01')

    -- 4. ì»¤ë²„ë§ ì¸ë±ìŠ¤ ì ìš©
    AND (team0_.company_id IN (SELECT company4_.id
                               FROM tb_company company4_
                               -- 5. LIKE ë¬¸ìì—´ ê²€ìƒ‰ ìµœì í™”
                               WHERE (company4_.name LIKE 'gmoon%')))
ORDER BY team0_.created_dt DESC
LIMIT 15 -- 6. no-offset í˜ì´ì§€ë„¤ì´ì…˜
```

**í•µì‹¬ ê°œì„  í¬ì¸íŠ¸ 11ê°€ì§€**

**1. íŠœë‹ ì „/í›„ ì‹¤í–‰ ê³„íšê³¼ ì¸ë±ìŠ¤ë¥¼ ë°˜ë“œì‹œ í™•ì¸**
   - EXPLAINìœ¼ë¡œ type, key, rows í™•ì¸
   - ê°œì„  ì „í›„ ë¹„êµë¡œ íš¨ê³¼ ê²€ì¦

**2. ë²”ìœ„ ì¡°ê±´ë³´ë‹¤ ë™ë“± ì¡°ê±´(=) ê¶Œì¥**
   - `WHERE id = 100` âœ… (const)
   - `WHERE id > 100` âš ï¸ (range, ì´í›„ ì»¬ëŸ¼ ì¸ë±ìŠ¤ ì‚¬ìš© ë¶ˆê°€)

**3. ë¶ˆí•„ìš”í•œ JOIN ì œê±° ê²€í† **
   - JOIN vs ìŠ¤ì¹¼ë¼ ì„œë¸Œ ì¿¼ë¦¬ ì„±ëŠ¥ ë¹„êµ í•„ìš”
   - ë°ì´í„° ì–‘ì— ë”°ë¼ ìŠ¤ì¹¼ë¼ ì„œë¸Œ ì¿¼ë¦¬ê°€ ë” ë¹ ë¥¼ ìˆ˜ ìˆìŒ
   - íŠ¹íˆ 1:N ê´€ê³„ì—ì„œ JOIN ì‹œ ì¤‘ë³µ ë°ì´í„° ë°œìƒ â†’ ë¶ˆí•„ìš”í•œ I/O

**4. ë¶€ì •ë¬¸ë³´ë‹¤ëŠ” ê¸ì •ë¬¸ ì‚¬ìš©**
   - `NOT IN` â†’ `IN` ë˜ëŠ” `EXISTS`ë¡œ ë³€ê²½
   - ì˜µí‹°ë§ˆì´ì €ê°€ ê¸ì •ë¬¸ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì‹¤í–‰í•˜ë¯€ë¡œ ì²˜ìŒë¶€í„° ê¸ì •ë¬¸ ì‚¬ìš©

**5. LIKE ë¬¸ìì—´ ê²€ìƒ‰ ì¡°ê±´ í™•ì¸**
   - âœ… `WHERE name LIKE 'gmoon%'` â†’ Index Scan
   - âŒ `WHERE name LIKE '%gmoon%'` â†’ Full Scan

**6. ì»¤ë²„ë§ ì¸ë±ìŠ¤ ì ìš©**
   - SELECT ì ˆì˜ ëª¨ë“  ì»¬ëŸ¼ì„ ì¸ë±ìŠ¤ì— í¬í•¨
   - Extra: Using index í™•ì¸

**7. no-offset í˜ì´ì§€ë„¤ì´ì…˜**
   - `LIMIT 15 OFFSET 10000` âŒ (10000ê°œë¥¼ ì½ê³  ë²„ë¦¼)
   - Cursor ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜ âœ…
   - [ìì„¸í•œ ë‚´ìš©](https://github.com/gmoon92/toy/blob/master/spring-jpa/spring-jpa-pagination/doc/cursor-pagination.md)

**8. Loose Index Scan ê³ ë ¤ (ì°¨ì„ ì±…)**
   - ì˜µí‹°ë§ˆì´ì €ê°€ ì˜ë„í•œ ì¸ë±ìŠ¤ë¥¼ íƒ€ì§€ ì•Šì„ ë•Œ
   - ê°•ì œë¡œ ì¸ë±ìŠ¤ ì»¬ëŸ¼ ë²”ìœ„ë¥¼ ì§€ì •í•˜ì—¬ Index Scan ìœ ë„
   - âš ï¸ ì˜¬ë°”ë¥¸ íŠœë‹ì€ ì•„ë‹ˆì§€ë§Œ, ì°¨ì„ ì±…ìœ¼ë¡œ ê³ ë ¤ ê°€ëŠ¥

   **Loose Index Scan ì¡°ê±´:**
   - ì»¤ë²„ë§ ì¸ë±ìŠ¤ ì ìš©
   - `SELECT DISTINCT`, `GROUP BY`, ë‹¨ì¼ íŠœí”Œ SELECT
   - ì§‘ê³„ í•¨ìˆ˜ì— `DISTINCT` í¬í•¨ (MIN/MAX ì œì™¸)
   - `COUNT(*)`ëŠ” ì‚¬ìš© ë¶ˆê°€
   - ë¶€ë¶„ í‚¤ ì¹´ë””ë„ë¦¬í‹°ê°€ ì „ì²´ì˜ 1/100 ì´í•˜

**9. ì¸ë±ìŠ¤ ìµœì í™” ëª…ë ¹**
   ```sql
   -- ì¸ë±ìŠ¤ ì¬êµ¬ì„± (ë‹¨í¸í™” ì œê±°)
   OPTIMIZE TABLE table_name;

   -- í…Œì´ë¸” í†µê³„ ì—…ë°ì´íŠ¸
   ANALYZE TABLE table_name;
   ```

**10. WHERE IN ì ˆ ìµœì í™”**
   - IN ì ˆì˜ ê°’ ê°œìˆ˜ì— ë”°ë¼ ì‹¤í–‰ ê³„íšì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ
   - ì˜µí‹°ë§ˆì´ì €ëŠ” IN ì ˆì„ **"equality range comparison"**ìœ¼ë¡œ ìµœì í™” ì²˜ë¦¬

   ```sql
   -- IN ì ˆì€ ì˜ë¯¸ìƒ ORì™€ ë™ì¼í•˜ì§€ë§Œ
   WHERE id IN ('id1', 'id2', 'id3', 'id4', 'id5')

   -- ë‹¨ìˆœ OR ë³€í™˜ì´ ì•„ë‹Œ equality rangeë¡œ ìµœì í™”ë¨
   -- WHERE id = 'id1' OR id = 'id2' ... (X)
   -- equality range comparison (O)
   ```

   **MySQL ì˜µí‹°ë§ˆì´ì € ë™ì‘ ë°©ì‹** ([MySQL 8.0 ê³µì‹ ë¬¸ì„œ](https://dev.mysql.com/doc/refman/8.0/en/range-optimization.html))
   - IN ì ˆ ê°’ì´ **ì ì„ ë•Œ**: Index Diveë¡œ ì •í™•í•œ í†µê³„ ìˆ˜ì§‘
   - IN ì ˆ ê°’ì´ **ë§ì„ ë•Œ**: Index Statisticsë¡œ ë¹ ë¥¸ ì¶”ì •
   - ì „í™˜ì : `eq_range_index_dive_limit` ì„¤ì •ê°’ (ê¸°ë³¸ 200)

   ```sql
   -- ì„¤ì • í™•ì¸ (Chapter 6-1 Index Dive ì°¸ê³ )
   SHOW VARIABLES LIKE 'eq_range_index_dive_limit';
   ```

   - IN ì ˆ ê°œìˆ˜ê°€ ë§ìœ¼ë©´ (200ê°œ ì´ìƒ) ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„±
   - ëŒ€ì•ˆ: ì„œë¸Œì¿¼ë¦¬, ì„ì‹œ í…Œì´ë¸”, ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ë¶„í•  ì²˜ë¦¬

**11. ì¹´ë””ë„ë¦¬í‹° ì˜ˆì™¸ ì „ëµ: IN ì ˆì„ Booleanìœ¼ë¡œ ë³€í™˜**

   ì¼ë°˜ì ìœ¼ë¡œ ì¹´ë””ë„ë¦¬í‹°ê°€ ë†’ì€ ì»¬ëŸ¼(ê³ ìœ  ê°’ì´ ë§ì€ ì»¬ëŸ¼)ì„ ë³µí•© ì¸ë±ìŠ¤ ì•ì— ë°°ì¹˜í•˜ëŠ” ê²ƒì´ ì›ì¹™ì´ì§€ë§Œ, **IN ì ˆì„ Boolean ì»¬ëŸ¼ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë³µí•© ì¸ë±ìŠ¤ ì¤‘ê°„ì— ë°°ì¹˜**í•˜ë©´ ì„±ëŠ¥ì„ í¬ê²Œ ê°œì„ í•  ìˆ˜ ìˆìŒ

   **ë¬¸ì œ ìƒí™©: IN ì ˆ ì‚¬ìš©**
   ```sql
   -- ì‚¬ìš©ì ìœ í˜•ì´ 20ê°œ ì¡´ì¬í•˜ëŠ” ê²½ìš°
   -- ê¸°ì¡´ ì¸ë±ìŠ¤: (user_id, created_at)
   CREATE INDEX idx_user_date ON users(user_id, created_at);

   -- ì¿¼ë¦¬: ë¬´ë£Œ ë¼ì´ì„¼ìŠ¤ ì‚¬ìš©ìë§Œ ì¡°íšŒ (ì „ì²´ì˜ 5-10%)
   SELECT * FROM users
   WHERE user_id = 100
     AND user_type IN ('FREE', 'TRIAL', 'BASIC')  -- Binary Search O(log 3)
     AND created_at > '2024-01-01';

   -- ë¬¸ì œ: IN ì ˆ ë¹„ìš© + ì¸ë±ìŠ¤ í™œìš© ì œí•œ
   ```

   **í•´ê²° ì „ëµ: Boolean Discriminator Column ì¶”ê°€**
   ```sql
   -- 1. Boolean ì»¬ëŸ¼ ì¶”ê°€ (ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„° ì €ì¥ ì‹œ ì„¤ì •)
   ALTER TABLE users ADD COLUMN is_free_license_user BOOLEAN DEFAULT false;

   -- ë˜ëŠ” Computed Column (MySQL 5.7+)
   ALTER TABLE users ADD COLUMN is_free_license_user BOOLEAN
   GENERATED ALWAYS AS (user_type IN ('FREE', 'TRIAL', 'BASIC')) STORED;

   -- 2. ë³µí•© ì¸ë±ìŠ¤ ì¬êµ¬ì„± (Boolean ì»¬ëŸ¼ì„ ì¤‘ê°„ì— ë°°ì¹˜)
   CREATE INDEX idx_user_license_date ON users(user_id, is_free_license_user, created_at);

   -- 3. ê°œì„ ëœ ì¿¼ë¦¬
   SELECT * FROM users
   WHERE user_id = 100
     AND is_free_license_user = true  -- Equality O(1) - ë¹ ë¦„!
     AND created_at > '2024-01-01';
   ```

   **ì„±ëŠ¥ ë¹„êµ**
   ```sql
   -- âŒ IN ì ˆ ë°©ì‹
   WHERE user_type IN ('FREE', 'TRIAL', 'BASIC')
   -- MySQLì€ IN ë¦¬ìŠ¤íŠ¸ë¥¼ ì •ë ¬ í›„ Binary Search: O(log n)
   -- ê°’ì´ ë§ì•„ì§ˆìˆ˜ë¡ (200ê°œ ì´ìƒ) ì„±ëŠ¥ ì €í•˜

   -- âœ… Boolean ë°©ì‹
   WHERE is_free_license_user = true
   -- Equality ë¹„êµ: O(1) - í•­ìƒ ë¹ ë¦„
   -- ë³µí•© ì¸ë±ìŠ¤ì—ì„œ ë‚®ì€ ì¹´ë””ë„ë¦¬í‹° ë¬¸ì œ ì—†ìŒ
   ```

   **ì™œ íš¨ê³¼ì ì¸ê°€?**
   - âœ… **IN ì ˆë³´ë‹¤ ë¹ ë¦„**: Binary Search O(log n) â†’ Equality O(1)
   - âœ… **ë³µí•© ì¸ë±ìŠ¤ ì „ì²´ í™œìš©**: (user_id, is_free_license_user, created_at) ëª¨ë‘ ì‚¬ìš©
   - âœ… **Range Scan ê°€ëŠ¥**: created_at ë²”ìœ„ ì¡°ê±´ë„ ì¸ë±ìŠ¤ í™œìš©
   - âœ… **ë°ì´í„° ë¶„í¬ í¸í–¥ í™œìš©**: is_free_license_user = trueê°€ 5-10%ì¼ ë•Œ íŠ¹íˆ íš¨ê³¼ì 
   - âœ… **ìŠ¤ì¼€ì¼ ê°€ëŠ¥**: user_typeì´ 3ê°œë“  20ê°œë“  ì„±ëŠ¥ ë™ì¼

   **ë³µí•© ì¸ë±ìŠ¤ì—ì„œ Boolean ì»¬ëŸ¼ì˜ ìœ„ì¹˜**
   ```sql
   -- âœ… ì˜¬ë°”ë¥¸ ì„¤ê³„: ê³ ì¹´ë””ë„ë¦¬í‹° â†’ Boolean â†’ ë²”ìœ„ ì¡°ê±´
   INDEX(user_id, is_free_license_user, created_at)
   --    â†‘ ë†’ì€ ì¹´ë””ë„ë¦¬í‹°  â†‘ Boolean (ì¤‘ê°„)  â†‘ Range

   -- âŒ ì˜ëª»ëœ ì„¤ê³„: Booleanì„ ë§¨ ì•ì— ë°°ì¹˜
   INDEX(is_free_license_user, user_id, created_at)
   -- Booleanì˜ ë‚®ì€ ì¹´ë””ë„ë¦¬í‹°ë¡œ ì¸ë±ìŠ¤ íš¨ìœ¨ ì €í•˜
   ```

   **MySQL ê³µì‹ ë¬¸ì„œ ê·¼ê±°**
   - **ë³µí•© ì¸ë±ìŠ¤ì—ì„œ Booleanì˜ ë‚®ì€ ì¹´ë””ë„ë¦¬í‹°ëŠ” ë¬¸ì œë˜ì§€ ì•ŠìŒ**
   - ì²« ì»¬ëŸ¼(user_id)ìœ¼ë¡œ ë°ì´í„°ê°€ ì¶©ë¶„íˆ í•„í„°ë§ë˜ë©´, Boolean ì»¬ëŸ¼ì´ ì¶”ê°€ í•„í„° ì—­í• 
   - ì°¸ê³ : [MySQL Composite Index Best Practices](https://dev.mysql.com/doc/refman/8.0/en/multiple-column-indexes.html)

   **ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ ë¹„êµ**
   ```sql
   -- í…ŒìŠ¤íŠ¸ í™˜ê²½: 1,000,000 rows, user_type 20ê°œ, FREE ì‚¬ìš©ì 5%

   -- âŒ IN ì ˆ ë°©ì‹: í‰ê·  120ms
   WHERE user_id = ? AND user_type IN ('FREE', 'TRIAL', 'BASIC')

   -- âœ… Boolean ë°©ì‹: í‰ê·  8ms (15ë°° ë¹ ë¦„)
   WHERE user_id = ? AND is_free_license_user = true
   ```

   **vs ì„ì‹œ í…Œì´ë¸” ë°©ì‹ ë¹„êµ**
   ```sql
   -- âŒ ì„ì‹œ í…Œì´ë¸”: ì¿¼ë¦¬ ì‹¤í–‰ ì‹œë§ˆë‹¤ ì˜¤ë²„í—¤ë“œ
   SELECT * FROM users u
   WHERE user_id = 100
     AND user_type IN (SELECT type FROM temp_free_types)  -- ì¡°ì¸ ë¹„ìš©
     AND created_at > '2024-01-01';

   -- âœ… Boolean ì»¬ëŸ¼: ì €ì¥ ì‹œ í•œ ë²ˆë§Œ ì„¤ì •, ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ ë¹„ìš© ì—†ìŒ
   WHERE user_id = 100
     AND is_free_license_user = true  -- ì¦‰ì‹œ í•„í„°ë§
     AND created_at > '2024-01-01';
   ```

   **ì£¼ì˜ì‚¬í•­**
   - ë°ì´í„° ë¶„í¬ê°€ **í¸í–¥ëœ ê²½ìš°**ì—ë§Œ ìœ íš¨ (ì˜ˆ: 5-10% vs 90-95%)
   - Boolean ê°’ì´ ê· ë“±í•˜ë©´ (50% vs 50%) íš¨ê³¼ ì œí•œì 
   - ìŠ¤í† ë¦¬ì§€ ê³µê°„ ì•½ê°„ ì¦ê°€ (Boolean ì»¬ëŸ¼ 1ë°”ì´íŠ¸)
   - ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì—ì„œ Boolean ê°’ì„ ì¼ê´€ë˜ê²Œ ê´€ë¦¬ í•„ìš”

**ë°œí‘œ ë©˜íŠ¸**

"ì´ ì‚¬ë¡€ì—ì„œ ê°€ì¥ í° íš¨ê³¼ë¥¼ ë³¸ ê²ƒì€ 3ê°€ì§€ì…ë‹ˆë‹¤.

ì²«ì§¸, ë¶ˆí•„ìš”í•œ JOINì„ ìŠ¤ì¹¼ë¼ ì„œë¸Œ ì¿¼ë¦¬ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤. JOINìœ¼ë¡œ ì¸í•œ ì¤‘ë³µ ë°ì´í„° ì²˜ë¦¬ ë¹„ìš©ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.

ë‘˜ì§¸, ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ì ìš©í•˜ì—¬ í…Œì´ë¸” ë°ì´í„° í˜ì´ì§€ ì ‘ê·¼ì„ ì™„ì „íˆ ì œê±°í–ˆìŠµë‹ˆë‹¤.

ì…‹ì§¸, no-offset í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ ë°ì´í„° ìŠ¤ìº”ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ 48ì´ˆ ê±¸ë¦¬ë˜ ì¿¼ë¦¬ê°€ 124msë¡œ ë‹¨ì¶•ë˜ì—ˆê³ , 504 íƒ€ì„ì•„ì›ƒ ì´ìŠˆê°€ ì™„ì „íˆ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤."

### 5-2. í˜„ì—…ì—ì„œ ë‹¹ì¥ ì¨ë¨¹ì„ í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ë°œí‘œ ë©˜íŠ¸**

"ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ë‚´ìš©ì„ ì‹¤ì „ì—ì„œ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆë„ë¡ í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤."

**1. ì¸ë±ìŠ¤ ë¬´íš¨í™” ì¡°ê±´ í”¼í•˜ê¸°**
```sql
-- âŒ ë‚˜ìœ ì˜ˆì‹œ
WHERE DATE(created_at) = '2024-01-01'  -- í•¨ìˆ˜ ì‚¬ìš©
WHERE name + 1 = 100                -- ì—°ì‚° ì‚¬ìš©
WHERE name LIKE '%ê²€ìƒ‰ì–´%'             -- ì¤‘ê°„ ì™€ì¼ë“œì¹´ë“œ

-- âœ… ì¢‹ì€ ì˜ˆì‹œ
WHERE created_at >= '2024-01-01' AND created_at < '2024-01-02'
WHERE name = 99
WHERE name LIKE 'ê²€ìƒ‰ì–´%'              -- ì• ê³ ì • ì™€ì¼ë“œì¹´ë“œ
```

**2. ë³µí•© ì¸ë±ìŠ¤ ì„¤ê³„ ì›ì¹™**
- ë™ë“± ì¡°ê±´(=)ì„ ì•ì—, ë²”ìœ„ ì¡°ê±´(>, <)ì„ ë’¤ì—
- ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ ìš°ì„ 
- ì„ íƒë„ ë†’ì€ ì»¬ëŸ¼ ìš°ì„  (ë‹¨, ì¿¼ë¦¬ íŒ¨í„´ì´ ë” ì¤‘ìš”)

**3. ì»¤ë²„ë§ ì¸ë±ìŠ¤ ì ê·¹ í™œìš©**
- SELECT ì ˆì— í•„ìš”í•œ ì»¬ëŸ¼ì„ ì¸ë±ìŠ¤ì— í¬í•¨
- Random I/O ì™„ì „ ì œê±° â†’ ìµœê³  ì„±ëŠ¥

**4. ì •ë ¬ ìµœì í™”**
- ORDER BY ì»¬ëŸ¼ì„ ì¸ë±ìŠ¤ì— í¬í•¨
- WHERE + ORDER BY ì¡°í•© ì‹œ ì¸ë±ìŠ¤ ìˆœì„œ ê³ ë ¤

**5. í•­ìƒ EXPLAINìœ¼ë¡œ ê²€ì¦**
- ê°œë°œ í›„ ë°˜ë“œì‹œ EXPLAIN í™•ì¸
- type, key, rows, Extra ì²´í¬
- íŠ¹íˆ ë°°í¬ ì „ ë¶€í•˜ í…ŒìŠ¤íŠ¸ì™€ í•¨ê»˜ ê²€ì¦

**6. ì‹¤ì œ ê°œì„  í”„ë¡œì„¸ìŠ¤**
1. ëŠë¦° ì¿¼ë¦¬ ë¡œê·¸ í™•ì¸ (slow query log)
2. EXPLAINìœ¼ë¡œ ì‹¤í–‰ ê³„íš ë¶„ì„
3. ì¸ë±ìŠ¤ ì¶”ê°€ ë˜ëŠ” ìˆ˜ì •
4. ì¿¼ë¦¬ ì¬ì‘ì„± (í•„ìš” ì‹œ)
5. EXPLAINìœ¼ë¡œ ê°œì„  í™•ì¸
6. ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦

**ë°œí‘œ ë©˜íŠ¸**

"í•µì‹¬ë§Œ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.

ì²«ì§¸, WHERE ì ˆì— í•¨ìˆ˜ë‚˜ ì—°ì‚°ì„ ì“°ì§€ ë§ˆì„¸ìš”. ì¸ë±ìŠ¤ê°€ ë¬´íš¨í™”ë©ë‹ˆë‹¤.

ë‘˜ì§¸, ë³µí•© ì¸ë±ìŠ¤ëŠ” ë™ë“± ì¡°ê±´ì„ ì•ì—, ë²”ìœ„ ì¡°ê±´ì„ ë’¤ì— ë°°ì¹˜í•˜ì„¸ìš”.

ì…‹ì§¸, ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¡œ Random I/Oë¥¼ ì™„ì „íˆ ì œê±°í•˜ì„¸ìš”.

ë„·ì§¸, ORDER BY ì»¬ëŸ¼ì„ ì¸ë±ìŠ¤ì— í¬í•¨ì‹œì¼œ Filesortë¥¼ ë°©ì§€í•˜ì„¸ìš”.

ë‹¤ì„¯ì§¸, ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ í•­ìƒ EXPLAINìœ¼ë¡œ ê²€ì¦í•˜ëŠ” ìŠµê´€ì…ë‹ˆë‹¤.

ì´ê²ƒìœ¼ë¡œ ë°œí‘œë¥¼ ë§ˆì¹˜ê² ìŠµë‹ˆë‹¤. ì§ˆë¬¸ ìˆìœ¼ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”."

## 6. Q&A (1ë¶„)

**ì˜ˆìƒ ì§ˆë¬¸**
- Q: ì¸ë±ìŠ¤ë¥¼ ë„ˆë¬´ ë§ì´ ë§Œë“¤ë©´ ë¬¸ì œê°€ ë˜ë‚˜ìš”?
  - A: ë„¤, INSERT/UPDATE ì„±ëŠ¥ì´ ì €í•˜ë©ë‹ˆë‹¤. ì¸ë±ìŠ¤ë„ ê´€ë¦¬ ë¹„ìš©ì´ ìˆìœ¼ë¯€ë¡œ ì‹¤ì œ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ íŒ¨í„´ì— ë§ì¶° í•„ìš”í•œ ì¸ë±ìŠ¤ë§Œ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.

- Q: JPAì—ì„œ ì¸ë±ìŠ¤ëŠ” ì–´ë–»ê²Œ ê´€ë¦¬í•˜ë‚˜ìš”?
  - A: Entity í´ë˜ìŠ¤ì˜ `@Table(indexes = {...})` ë˜ëŠ” `@Index` ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì „ì—ì„œëŠ” DDLì„ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ë” ëª…í™•í•©ë‹ˆë‹¤.

- Q: ì¸ë±ìŠ¤ ê°œì„  íš¨ê³¼ëŠ” ì–´ëŠ ì •ë„ì¸ê°€ìš”?
  - A: ì‹¤ì œ ì‚¬ë¡€ì—ì„œ 10~100ë°° ì„±ëŠ¥ ê°œì„ ì€ í”í•˜ë©°, ì˜ ì„¤ê³„í•˜ë©´ 1000ë°° ì´ìƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. íŠ¹íˆ ëŒ€ìš©ëŸ‰ í…Œì´ë¸”ì¼ìˆ˜ë¡ íš¨ê³¼ê°€ ê·¹ì ì…ë‹ˆë‹¤.

- Q: ìš°ë¦° MySQL ì´ ì•„ë‹Œë°ìš”?
  - A: ì¸ë±ìŠ¤ ìë£Œêµ¬ì¡°ê°€ B+Tree ë¼ë©´ ê¸°ë³¸ ë™ì‘ ë©”ì»¤ë‹ˆì¦˜ì€ ë™ì¼í•©ë‹ˆë‹¤. ë‹¤ë§Œ. ë‹¤ë¥¸ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì˜µí‹°ë§ˆì´ì €ì˜ ì‹¤í–‰ ê³„íšì— ë”°ë¥¸ ì¸ë±ìŠ¤ ì„ ì • ë°©ì‹ì´ ë‹¬ë¼ì§ˆ ìˆœ ìˆìŠµë‹ˆë‹¤.


---

**ë°œí‘œ ì¢…ë£Œ**

ê°ì‚¬í•©ë‹ˆë‹¤!
