# Index page record and column length

MySQL InnoDB 페이지는 데이터가 저장되는 기본 단위이며, 기본 페이지 크기는 16KB 다.

페이지엔 여러 구성 요소가 존재하는데, 그 중 "User Records" 영역에서 인덱스 키를 관리한다.

따라서 컬럼 길이가 커지면, 하나의 페이지당 관리하는 인덱스 레코드 수가 적어지게 되고, 인덱스의 효율성에 영향이 미칠 수 있기 때문에 조회 성능을 고려해서 컬럼 길이를 선정해야 한다.

> MySQL InnoDB 기본 페이지 크기는 16KB 다. MySQL 5.7 이상 버전에서는 `innodb_page_size` 시스템 변수로 조절 가능하다.

## InnoDB 레코드 오버헤드 상세 분석
### 트랜잭션과 레코드 관리 및 인덱싱에 필요한 추가 정보 관리

MySQL InnoDB에서 레코드는 테이블 컬럼 데이터 이외에, 고정적으로 추가적인 오버헤드 정보가 포함된다.

InnoDB에서 추가 오버헤드가 필요한 이유는 데이터베이스 시스템이 각 레코드를 관리하고, 트랜잭션 처리 및 인덱싱 등을 효율적으로 수행하기 위해 추가 정보를 저장하기 때문이다. 이 오버헤드는 각 레코드에 필요한 메타데이터와 관리 정보를 저장하기 위해 사용된다.

일반적으로 각 레코드에 추가되는 오버헤드는 여러 요소로 구성된다.

1. **Fixed-Size Data Header (5 bytes)**
    - **1 byte**: 레코드 타입 플래그, 인덱스와 관련된 정보를 포함한다.
    - **4 bytes**: `next record` 포인터 (다음 레코드를 가리키는 포인터).
2. **Transaction ID (6 bytes)**
    - 각 레코드가 어느 트랜잭션에 의해 생성되었는지를 구분 값이다.
3. **Roll Pointer (7 bytes)**
    - 이전 레코드를 가리키는 포인터로, InnoDB의 다중 버전 동시성 제어(MVCC)에서 사용된다.
4. **Variable-Size Data Header (varies, 1-5 bytes)**
    - `NULL` 비트맵 및 각 열에 대한 길이 정보 등이 포함한다.

MySQL InnoDB에서의 레코드 오버헤드와 관련된 내용은 조금 더 복잡하며, 실제로는 다양한 오버헤드 요소가 존재하고, 이들의 크기는 상황에 따라 달라질 수 있다.

> InnoDB에서의 정확한 오버헤드는 테이블의 구조와 데이터베이스 설정에 따라 달라지므로, 정확한 크기를 알기 위해서는 실험적 측정 또는 MySQL 공식 문서의 구체적인 내용을 참조하는 것이 좋다.

평균적으로 약 **19 ~ 23 bytes** 오버헤드가 필요하다. 이 값은 레코드 타입, 트랜잭션 특성, 테이블의 구조 등에 따라 조금씩 달라질 수 있다.

## 페이즈당 레코드 수 계산 공식

테이블의 컬럼 길이는 페이지당 저장할 수 있는 레코드 수는 인덱스의 효율성에 직접적인 영향을 미치기 때문에, InnoDB에서 컬럼 길이와 오버헤드를 포함하여 페이지당 인덱스 레코드 수를 계산하는 공식은 매우 중요하다.

**"페이지당 레코드 수"** 는 유효 페이지 크기 `S`를 레코드 크기 `R`로 나눠서 페이지당 레코드 수를 계산한다.

```plaintext
페이지당 레코드 수 = 유효 페이지 크기 (S) / 레코드 크기 (R = 컬럼 길이 + 오버헤드(O))
```

1. 페이지 크기 (`P`): 16KB(16,384 bytes) (InnoDB에서 기본 페이지 크기)
2. 고정 오버헤드 (`O`): 약 "19 ~ 23 bytes", InnoDB의 각 레코드에 추가되는 고정 오버헤드.
3. 레코드 크기 (`R`): **레코드의 실제 데이터 크기 (컬럼 길이)**
   - 레코드 크기 = 컬럼 길이 + 오버헤드 (O)
4. 유효 페이지 크기 (`S`): 약 16,184 bytes, 페이지 크기(P)에서 페이지 헤더와 트레일러를 뺀 유효 공간.

## 마무리
### UUID 문자열 페이지당 레코드 수

예를 들어 UUID 문자열(`VARCHAR(36)`)의 컬럼 기준으로 계산해보자.

```plaintext
페이지당 레코드 수 = S / R

S = 16,184 bytes
O = 20 bytes
R = 56 bytes = 36 bytes + 20 bytes
```

- 유효 페이지 크기 (`S`): 16,184 bytes (페이지 크기에서 헤더와 트레일러를 뺀 값)
- 오버헤드 (`O`): 20 bytes 로 가정.
- 레코드 크기 (`R`): 레코드의 데이터 크기
  - 레코드 크기: `36bytes` (문자열) + `20bytes` (오버헤드) = `56bytes`
    - UUID 문자열은 영어와 숫자로 구성 (ex. 123e4567-e89b-12d3-a456-426614174000)
    - 영어, 숫자는 1byte 로 표현 (charset 무관)
        - ASCII 또는 UTF-8, 그리고 UTF-8MB4로 설정됐더라도, 영어와 숫자 로 구성된 UUID 문자열의 크기는 각 1byte 로 계산한다.
- 페이지당 레코드 수: `16,184 / 56 ≈ 289`

1개의 페이지는 약 289개 UUID 문자열 레코드를 저장할 수 있다.
