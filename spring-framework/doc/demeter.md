## 우아한 도메인 설계
## 디미터 법칙(Don't Talk to Strangers)
## 객체간의 협력 경로를 제한한다.

## history

디미터라는 프로젝트를 진행하던 중, OOP에서 객체들의 협력 경로를 제한하면 객체간의 결합도를 낮추는 사실을 발견했다.
이러한 배경으로 __객체간 협력 경로를 제한하는 법칙__을 "디미터 법칙"이라 한다.

> [Object-Oriented Programming: An Objective Sense of Style](https://dl.acm.org/doi/10.1145/62084.62113)

이 법칙은 "클린 코드", "오브젝트", "소트웍스 앤솔러지" 그외 다수 OOP와 관련된 서적에서도 디미터 법칙을 다루고 있다.
이처럼 디미터 법칙은 클린 코드를 지향하기 위해 필히 숙지하고 있어야할 여러 법칙중 하나이다.

> 책 첨언
- 클린 코드 :
- 오브젝트 : 협력 경로를 제한하라,
- 소트웍스 앤솔러지 : 객체지향 생활 체조 9가지 원칙
    - 규칙 4: 한줄에 점을 하나만 찍는다.

## 핵심

객체 구조의 경로를 따라 멀리 떨어져 있는 낯선 객체에 메시지를 보내는 설계를 피하라는 것이다.
Principle of least knowledge(최소 지식 원칙)


객체는 그것이 내부적으로 보유하고 있거나 메시지를 통해 확보한 정보만 가지고 의사 결정을 내려야 한다.

객체의 내부 구조에 강하게 결합되지 않도록 협력 경로를 제한하라.

객체 지향 생활 체조 원칙 중 **한줄에 점을 하나만 찍는다.**라고 요약되기도 한다.
규칙 4. 한줄에 점을 하나만 찍는다.
이 원칙은 OCP와도 관련이 깊은 법칙이다.

--

## 규칙

1. 객체 자신의 메서드
2. 메서드의 파라미터로 넘어온 객체들의 메서드
3. 메서드 내부에서 생성, 초기화된 객체의 메서드
4. 인스턴스 변수로 가지고 있는 객체가 소유한 메서드

---

## 예외

1. 자료구조라면 디미터 법칙을 거론할 필요가 없다.

객체라면 내부 구조를 숨겨야 하므로 디미터 법칙을 지켜야 한다.
하지만 자료구조라면 당연히 내부 구조를 노출해야 하므로 디미터 법칙이 적용되지 않는다.
객체와 자료구조의 차이가 궁금하다면 이 글을 참고하자.

2. 하나의 .을 강제하는 규칙이 아니다.

디미터 법칙은 객체 지향 생활 체조 원칙 중 한 줄에 점을 하나만 찍는다.로 요약되기도 한다.

``` java
IntStream.of(1, 15, 3, 20)
         .filter(x -> x > 10)
         .count();
```

하지만 위 코드는 디미터 법칙과 객체 지향 생활 체조 원칙을 위반한 코드가 아니다.

디미터 법칙은 결합도와 관련된 법칙이고 결합도가 문제 되는 것은 객체의 내부 구조가 외부로 노출되는 경우이다.
위 코드는 IntStream의 내부 구조가 노출되지 않았다. 단지 IntStream을 다른 IntStream으로 변환할 뿐, 객체를 둘러싸고 있는 캡슐은 유지한다.

한 줄에 하나 이상의 점을 찍는 모든 케이스가 객체 지향 생활 체조 원칙 및 디미터 법칙을 위반하는 것은 아니다.
객체 내부 구현에 대한 어떤 정보도 외부로 노출하지 않는다면 괜찮다.

``` java
User user = userRepository.get(0);
String teamName = user.getTeam().getName();
```

# Train wreck

``` java
User user = userRepository.get(0);
String teamName = user.getTeam().getName();
//                          ^-- 기차 충돌, 타고타고 들어가는 메서드 체이닝은 옳지 못한다.

String teamName = Optional.ofNullable(user.getTeam())
                    .map(Team::getName)
                    .else("");


//String teamName = user.getTeam().getName();
```

유저에 팀이 없을경우 NPE(NullPointException) 발생할 우려가 있기 때문에

``` java
class User {
    // ... 생략
    public String teamName(){
        if(team == null){
            return "";
        }
        return team.getName();
    }
    // 이 메소드가 사용자 도메인의 관심사인가?, 자칫 Team 비대해질 수 있다.
}
```



