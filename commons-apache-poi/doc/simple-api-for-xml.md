# Simple API for XML(SAX)

## "큰 XML을 작게 처리하는" 가장 실용적인 방법이다.

SAX(Simple API for XML)는
XML 문서를 **이벤트 기반으로 처리**하는 Java의 대표적인 표준 API다.

빠르고 가벼운 XML 처리 방식이 필요한 프로젝트에서 널리 활용되고 있다.

> DOM이 XML을 "한꺼번에 메모리에 올려서 처리"한다면, SAX는 "읽는 즉시 처리하고 버리는" 방식이다.

### 요구 사항

- Java 1.1 이상
- SAX2 호환 XML 파서 필요 (예: Xerces, JAXP 기본 제공)
- 대부분의 Java 환경(JDK, WAS)은 기본 내장됨

대부분의 Java/XML 라이브러리, 웹 애플리케이션 서버에는 이미 SAX2와 그에 맞는 파서가 포함되어 있다.
특히 JAXP 1.1 이상 환경에서는 기본적으로 SAX2를 지원한다.

> 최신 버전은 [2.0.1](https://mvnrepository.com/artifact/sax/sax/2.0.1)이며, 소스
> 자료는 [SourceForge](https://sourceforge.net/projects/sax/files/)에서 확인할 수 있다.

## 이벤트 기반 vs 트리 기반

XML(또는 SGML) API는 크게 두 가지 방식이 있다.

- 트리 기반 API
- 이벤트 기반 API

### 트리 기반 API

대표적으로 W3C에서 관리하는 DOM(Document Object Model) 표준이 있다.

트리 기반 API는 XML 문서를 내부의 트리 구조로 변환한 다음, 애플리케이션이 그 트리를 탐색하면서 원하는 데이터를 처리할 수 있도록 한다.

- 전체 문서 구조를 탐색하거나 수정하기에 유용하지만,
- 문서가 커질수록 시스템 메모리 사용량이 급격히 늘어난다.

### 이벤트 기반 API

SAX가 대표적인 이벤트 기반 API다.

DOM처럼 문서를 통째로 메모리에 올리는 대신 XML을 파싱 과정에서 **XML 요소가 등장할 때마다 콜백으로 이벤트(예: 요소의 시작과 끝 등)를 애플리케이션에게 바로 전달해준다.**

- **메모리 효율**: 수백 MB\~GB급 XML도 처리 가능
    - 내부에 별도의 트리 구조를 만들지 않는다.
- **속도**: 트리 생성 없이 한 번에 스트리밍
    - 애플리케이션은 **이벤트별로 핸들러를 구현해 해당 이벤트를 처리한다.**
- **콜백 기반**: GUI(그래픽 사용자 인터페이스) 이벤트 처리와 유사한 방식이다.

#### 언제 SAX를 써야 하나?

XML 전체 구조를 수정하거나 여러 번 탐색해야 한다면 트리 기반 API가 유리하지만, 대용량 데이터나 단순 추출 목적엔 비효율적이다. XML 트리를 통째로 쓰기보다 자체적인 데이터 구조로 변환해 활용하는 경우가
많기 때문이다. 트리를 굳이 만들고 다시 다른 구조로 옮긴 뒤, 원래 트리는 버리는 식의 처리는 비효율적이다.

이럴 땐 이벤트 기반 API가 단순하고 효율적인 접근을 제공한다.

SAX는 메모리에 올릴 수 없을 정도로 매우 큰 XML 문서도 순차적으로 읽으면서 조건에 맞는 요소만 실시간으로 필터링할 수 있다.

- 대용량 Excel(XLSX) 스트리밍 (Apache POI + SAX)
- XML 기반 로그 분석, 대용량 데이터 추출
- 특정 조건의 레코드만 추출
- JAXB, JAXP 등 내부에서도 많이 사용

예를 들어, `"gmoon"`이라는 문자열이 포함된 `<record>` 요소를 추출할 경우에도,  
문서를 통째로 메모리에 올리지 않고 SAX 이벤트 흐름 속에서 원하는 데이터 구조를 **실시간으로 구성**할 수 있다.

> SAX는 20MB든 2GB든 문서를 한 번 읽으면서 필요한 정보만 실시간으로 뽑아낼 수 있는 스트리밍 필터링 도구다.

#### SAX 이벤트 흐름

SAX 파서는 다음과 같은 이벤트 순서로 처리한다.

```xml
<?xml version="1.0"?>
<doc>
    <para>Hello, world!</para>
</doc>
```

1. start document
2. start element: doc
3. start element: para
4. characters: Hello, world!
5. end element: para
6. end element: doc
7. end document

애플리케이션은 이 이벤트들을, 마치 GUI의 이벤트처럼, 하나하나 처리할 수 있다.

전체 문서를 메모리나 보조 저장소에 저장할 필요가 없다.

> 각 이벤트에서 콜백 메서드(startElement, characters, endElement)를 직접 구현하여 처리

## 마무리

SAX는 XML을 **한 번만 읽으면서 실시간으로 원하는 정보를 추출**할 수 있게 해준다.  
문서 전체를 메모리에 올릴 수 없거나, 단순 추출이 주 목적이라면 DOM보다 훨씬 효율적이다.

> SAX는 "읽으면서 바로 처리"한다.  
> 크고 무거운 XML 문서에서도 필요한 정보만 빠르게 뽑아내고 싶은 상황이라면, 가장 가볍고 실용적인 선택이다.

|         | DOM 방식       | SAX 방식        |
|---------|--------------|---------------|
| 처리 방식   | 트리로 전체 파싱    | 이벤트 기반 스트리밍   |
| 메모리 사용량 | 크다           | 거의 사용 안함      |
| 접근      | 자유 탐색 가능     | 순차 처리만 가능     |
| 사용 용도   | 전체 구조 탐색, 수정 | 특정 정보 추출, 필터링 |
| 유연성     | 높음           | 낮음(순차처리)      |

마지막으로, 이벤트 기반 API를 사용해서 직접 파싱 트리를 만들 수도 있고, 반대로 이벤트 기반 API로 이미 메모리에 만들어진 트리를 순회할 수도 있다는 점도 기억하자.

## Reference

- [www.saxproject.org](http://www.saxproject.org/about.html)

