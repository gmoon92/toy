# ADR-003: Module Organization by Change Frequency

## 상태
- **상태**: 수락됨 (Accepted)
- **날짜**: 2026-02-13
- **결정자**: architecture-analyst

## 맥락

### 문제 상황
대형 코드베이스에서 모듈 경계는 다음을 결정합니다:
- 리팩토링 용이성
- 테스트 격리
- 병렬 개발 효율

기능별 조직은 변경 시 여러 모듈을 동시에 수정해야 합니다.

### 제약 조건
- Rust의 모듈 시스템 준수
- 순환 의존성 금지
- 컴파일 시간 최소화

## 결정

### 선택한 방안: 변경 빈도 기준 모듈 분리

```
src/
├── types.rs          # 안정적 - 변경 빈도: 낮음
├── error.rs          # 안정적 - 변경 빈도: 낮음
├── config.rs         # 안정적 - 변경 빈도: 낮음
│
├── core/             # 중간 - 변경 빈도: 중간
│   ├── arena.rs
│   ├── pipeline.rs
│   └── engine.rs
│
├── parser/           # 중간 - 변경 빈도: 중간
├── generator/        # 진화적 - 변경 빈도: 높음
├── transformer/      # 실험적 - 변경 빈도: 높음
│
└── output/           # 안정적 - 변경 빈도: 낮음
```

### 근거

**BPlusTree3 사례:**
- 3,138줄 → 13개 모듈 분리
- 리팩토링 시 변경 모듈 수 80% 감소
- 테스트 격리도 향상

| 변경 빈도 | 특성 | 예시 |
|-----------|------|------|
| 낮음 | 신중한 설계, API 안정성 | types, error |
| 중간 | 기능 확장 시 변경 | core, parser |
| 높음 | 빈번한 실험/리팩토링 | generator, transformer |

## 대안 고려

| 대안 | 장점 | 단점 | 결정 |
|------|------|------|------|
| 기능별 | 직관적 | 변경 시 다수 모듈 수정 | ❌ |
| 계층별 | 아키텍처 명확 | 과도한 추상화 | ⚠️ |
| 변경 빈도 | 리팩토링 용이 | 초기 학습 곡선 | ✅ |
| 도메인별 | 비즈니스 정렬 | 기술적 관심사 분산 | ❌ |

## 영향

### 긍정적 영향
- 리팩토링 격리
- 병렬 개발 가능
- 코드 안정성 예측 가능

### 부정적 영향
- 초기 학습 곡선
- 모듈 간 경계 모호할 수 있음
- 과도한 분리 위험

### 위험 및 완화
| 위험 | 완화 전략 |
|------|----------|
| 과도한 분리 | 100-600줄/파일 가이드라인 |
| 경계 모호 | 변경 빈도 주기적 재평가 |
| 의존성 복잡 | 의존성 그래프 문서화 |

## 관련 문서

- `architecture-principles.md` - 원칙 3
- `code-structure-design.md` - 전체 구조
